<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Estancia</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-estancia"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-estancia"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoEstancia">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaGraficasEstancia">
            <i class="bi bi-graph-up me-2"></i>Vista de Gráficas
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirEstancia()">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<!-- VISTA DE TRABAJO -->
<div id="estancia-trabajo">
    <div class="card mb-4 shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold"><i class="bi bi-plus-circle me-2"></i>Registrar Ocupación Diaria</h6>
        </div>
        <div class="card-body">
            <form id="formEstancia" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label small fw-bold"><i class="bi bi-calendar-event me-1"></i>Fecha
                        Registro</label>
                    <div class="input-group">
                        <input type="date" id="estancia_fecha" class="form-control" required readonly>
                        <button class="btn btn-outline-secondary" type="button" id="btnToggleLockFecha"
                            title="Bloquear/Desbloquear fecha">
                            <i class="bi bi-lock-fill" id="iconLockFecha"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Hab. Ocupadas</label>
                    <input type="number" id="estancia_ocupadas" class="form-control" min="0" max="190" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Total Hotel</label>
                    <input type="text" id="estancia_total_ref" class="form-control bg-light" value="190" readonly>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100 fw-bold py-2"><i class="bi bi-save-fill me-2"></i>Guardar Registro</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">Listado Diario del Mes</h6>
            <div class="d-flex gap-2">
                <select id="filtroMonthEstancia" class="form-select form-select-sm" style="width: 130px;"
                    onchange="mostrarEstancia()">
                    <option value="0">Enero</option>
                    <option value="1">Febrero</option>
                    <option value="2">Marzo</option>
                    <option value="3">Abril</option>
                    <option value="4">Mayo</option>
                    <option value="5">Junio</option>
                    <option value="6">Julio</option>
                    <option value="7">Agosto</option>
                    <option value="8">Septiembre</option>
                    <option value="9">Octubre</option>
                    <option value="10">Noviembre</option>
                    <option value="11">Diciembre</option>
                </select>
                <select id="filtroYearEstancia" class="form-select form-select-sm" style="width: 90px;"
                    onchange="mostrarEstancia()"></select>
                <button class="btn btn-sm btn-outline-success" onclick="exportarEstanciaExcel()">
                    <i class="bi bi-file-earmark-spreadsheet me-1"></i>Exportar Excel
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
                <thead class="table-light">
                    <tr>
                        <th>Día</th>
                        <th>Ocupadas</th>
                        <th>Vacías/Bloq.</th>
                        <th>Libres</th>
                        <th>% Ocupación</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaEstanciaCuerpo"></tbody>
                <tfoot class="table-light fw-bold" id="tablaEstanciaPie"></tfoot>
            </table>
        </div>
    </div>
</div>

<!-- VISTA DE GRÁFICAS -->
<div id="estancia-graficas" class="d-none">
    <div class="row g-4">
        <div class="col-md-8">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header py-3">
                    <h6 class="mb-0 fw-bold">Evolución de Ocupación (%)</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px;"><canvas id="chartEstanciaEvolucion"></canvas></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-primary bg-gradient text-white h-100" id="estancia_anual_stats">
                <!-- Inyectado por JS -->
            </div>
        </div>
    </div>
</div>