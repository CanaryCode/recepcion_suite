<!-- MÓDULO DE EXCURSIONES Y TICKETS -->
<div class="animate-fade-in" id="excursiones-container">
    <!-- Encabezado de Impresión (Solo para Reporte de Lista) -->
    <div class="d-none d-print-block report-header-print mb-4 p-3 border rounded shadow-sm">
        <div class="row align-items-center">
            <div class="col-6">
                <h2 class="fw-bold text-primary mb-1">PROFORMA / REPORTE DE VENTAS</h2>
                <h5 class="text-secondary mb-0">Excursiones & Tickets • Hotel Garoé</h5>
            </div>
            <div class="col-6 text-end small">
                <div class="mb-1"><strong>RECEPCIÓN SUITE v2</strong></div>
                <div><strong>Fecha de Emisión:</strong> <span id="print-date-excursiones"></span></div>
                <div><strong>Gestionado por:</strong> <span id="print-repc-nombre-excursiones"></span></div>
                <div class="text-muted mt-2" style="font-size: 7.5pt;">Documento de uso informativo interno. Sujeto a cambios operativos.</div>
            </div>
        </div>
        <div class="border-top mt-3 pt-2 text-center small text-muted">
            <i class="bi bi-info-circle me-1"></i> Este listado muestra el histórico de ventas registradas en el sistema.
        </div>
    </div>

    <!-- Encabezado Visual -->
    <h4 class="module-title-discrete no-print">
        <i class="bi bi-ticket-perforated-fill me-2"></i>VENTA DE EXCURSIONES & TICKETS
    </h4>

    <!-- Barra de Herramientas Estándar -->
    <div class="module-toolbar d-flex justify-content-between align-items-center p-2 mb-3 no-print">
        <div class="btn-group shadow-sm">
            <button class="btn btn-outline-primary active" id="btnExcursionesVistaVenta">
                <i class="bi bi-cart-plus me-2"></i>Nueva Venta
            </button>
            <button class="btn btn-outline-primary" id="btnExcursionesVistaLista">
                <i class="bi bi-journal-text me-2"></i>Historial
            </button>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-success btn-sm fw-bold shadow-sm" onclick="Excursiones.exportarCSV()">
                <i class="bi bi-file-earmark-excel me-2"></i>Exportar
            </button>
            <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="Excursiones.imprimirReporte()">
                <i class="bi bi-printer me-2"></i>Imprimir Listado / Proforma
            </button>
        </div>
    </div>

    <!-- VISTA 1: FORMULARIO DE VENTA -->
    <div id="excursiones-venta" class="view-section">
        <div class="row">
            <!-- Formulario -->
            <div class="col-lg-7">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body p-4">
                        <form id="formExcursionVenta">
                            <input type="hidden" id="exc_id">
                            
                            <div class="row g-3">
                                <!-- Selección de Producto -->
                                <div class="col-12">
                                    <label class="form-label small fw-bold">Producto / Excursión</label>
                                    <select id="exc_tipo_id" class="form-select form-select-lg border-2 border-primary border-opacity-25" required>
                                        <option value="" selected disabled>Seleccione una opción...</option>
                                    </select>
                                </div>

                                <!-- Datos del Cliente -->
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Habitación</label>
                                    <div class="input-group">
                                        <input type="text" id="exc_habitacion" class="form-control text-center fw-bold" placeholder="000" required>
                                        <div class="input-group-text bg-white">
                                            <input class="form-check-input mt-0 me-2" type="checkbox" id="exc_es_externo" onchange="Excursiones.toggleExterno(this.checked)">
                                            <label class="form-check-label small mb-0" for="exc_es_externo">Externo</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6" id="wrap_exc_nombre_huesped">
                                    <label class="form-label small fw-bold">Nombre del Huésped</label>
                                    <input type="text" id="exc_huesped" class="form-control" placeholder="John Doe">
                                </div>

                                <div class="col-md-12 d-none" id="wrap_exc_nombre_externo">
                                    <label class="form-label small fw-bold text-danger">Nombre Cliente Externo / External Client Name</label>
                                    <input type="text" id="exc_nombre_externo" class="form-control border-danger border-opacity-25" placeholder="Escriba el nombre completo del cliente">
                                </div>

                                <!-- Fechas -->
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Fecha de Actividad</label>
                                    <input type="date" id="exc_fecha_actividad" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Estado Pago</label>
                                    <select id="exc_estado" class="form-select">
                                        <option value="Cobrado">✅ Cobrado</option>
                                        <option value="Pendiente">⏳ Pendiente</option>
                                    </select>
                                </div>

                                <!-- Cantidades -->
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold">Adultos</label>
                                    <div class="input-group input-group-sm">
                                        <button class="btn btn-outline-secondary" type="button" onclick="Excursiones.adjustQty('exc_adultos', -1)">-</button>
                                        <input type="number" id="exc_adultos" class="form-control text-center" value="1" min="0">
                                        <button class="btn btn-outline-secondary" type="button" onclick="Excursiones.adjustQty('exc_adultos', 1)">+</button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold">Niños</label>
                                    <div class="input-group input-group-sm">
                                        <button class="btn btn-outline-secondary" type="button" onclick="Excursiones.adjustQty('exc_ninos', -1)">-</button>
                                        <input type="number" id="exc_ninos" class="form-control text-center" value="0" min="0">
                                        <button class="btn btn-outline-secondary" type="button" onclick="Excursiones.adjustQty('exc_ninos', 1)">+</button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-primary">Grupos</label>
                                    <div class="input-group input-group-sm">
                                        <button class="btn btn-outline-primary" type="button" onclick="Excursiones.adjustQty('exc_grupos', -1)">-</button>
                                        <input type="number" id="exc_grupos" class="form-control text-center" value="0" min="0">
                                        <button class="btn btn-outline-primary" type="button" onclick="Excursiones.adjustQty('exc_grupos', 1)">+</button>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <label class="form-label small fw-bold text-muted">Comentarios / Observaciones</label>
                                    <textarea id="exc_comments" class="form-control" rows="2" placeholder="Notas adicionales sobre la reserva..."></textarea>
                                </div>

                                <div class="col-12 mt-4 pt-3 border-top">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="exc_imprimir_ticket">
                                            <label class="form-check-label small fw-bold" for="exc_imprimir_ticket">Imprimir ticket al guardar</label>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="button" class="btn btn-light" onclick="Excursiones.limpiarFormulario()">
                                                <i class="bi bi-eraser me-2"></i>Limpiar
                                            </button>
                                            <button type="submit" class="btn btn-primary btn-lg px-5 shadow">
                                                <i class="bi bi-check2-circle me-2"></i>REGISTRAR VENTA
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Resumen y Previsualización -->
            <div class="col-lg-5">
                <div class="card border-0 shadow-sm bg-light mb-4 sticky-top" style="top: 20px;">
                    <div class="card-body p-4">
                        <h6 class="fw-bold mb-4 border-bottom pb-2">RESUMEN DE VENTA</h6>
                        
                        <div id="exc_summary_empty" class="text-center py-5 text-muted">
                            <i class="bi bi-cart3 fs-1 d-block mb-3 opacity-25"></i>
                            Seleccione una excursión para ver el presupuesto
                        </div>

                        <div id="exc_summary_content" class="d-none">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Producto:</span>
                                <span id="summary_nombre" class="fw-bold">---</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">Operador:</span>
                                <span id="summary_operador">---</span>
                            </div>
                            <hr>
                            <div class="d-flex justify-content-between mb-2">
                                <span id="summary_adultos_label">Adultos (0 x 0€):</span>
                                <span id="summary_adultos_subtotal">0.00€</span>
                            </div>
                             <div id="summary_ninos_row" class="d-flex justify-content-between mb-2 d-none">
                                <span id="summary_ninos_label">Niños (0 x 0€):</span>
                                <span id="summary_ninos_subtotal">0.00€</span>
                            </div>
                            <div id="summary_grupos_row" class="d-flex justify-content-between mb-2 d-none">
                                <span id="summary_grupos_label" class="text-primary">Grupos (0 x 0€):</span>
                                <span id="summary_grupos_subtotal" class="text-primary fw-bold">0.00€</span>
                            </div>
                            
                            <div class="mt-4 p-3 bg-white rounded border border-primary border-opacity-25 text-center">
                                <div class="small fw-bold text-primary mb-1">TOTAL A COBRAR</div>
                                <div id="summary_total" class="display-6 fw-bold">0.00€</div>
                            </div>
                            
                            <div class="mt-4 alert alert-info d-flex align-items-center small py-2">
                                <i class="bi bi-info-circle me-2"></i>
                                Active el interruptor inferior si desea imprimir el ticket ahora.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VISTA 2: LISTADO HISTÓRICO -->
    <div id="excursiones-lista" class="view-section d-none">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold">Ventas Realizadas</h6>
                    <div class="input-group input-group-sm w-auto">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" id="search-excursiones" class="form-control" placeholder="Hab, Nombre, Excursión...">
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Fecha Venta</th>
                                <th>Hab</th>
                                <th>Huésped</th>
                                <th>Producto</th>
                                <th class="text-center">Pax</th>
                                <th class="text-end">Total</th>
                                <th class="text-center">Estado</th>
                                <th class="text-end d-print-none">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="table-excursiones-ventas"></tbody>
                    </table>
                </div>
                <div id="empty-excursiones-list" class="text-center py-5 d-none">
                    <i class="bi bi-inbox fs-1 text-muted opacity-25"></i>
                    <p class="mt-2">No se han registrado ventas todavía</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- FORMATO TICKET (IMPRESIÓN) -->
<div id="ticket-excursion-print" class="d-none">
    <div style="width: 80mm; font-family: 'Courier New', Courier, monospace; font-size: 12px; padding: 10px;">
        <div style="text-align: center; font-weight: bold; margin-bottom: 5px;">
            HOTEL GAROÉ<br>
            RECEPCTION SUITE v2
        </div>
        <div style="text-align: center; margin-bottom: 10px; border-bottom: 1px dashed #000; padding-bottom: 5px;">
            TICKET DE EXCURSIÓN / TICKET
        </div>
        
        <table style="width: 100%; border-collapse: collapse;">
            <tr><td>ID:</td><td style="text-align: right;" id="tk_id">---</td></tr>
            <tr><td>FECHA VENTA:</td><td style="text-align: right;" id="tk_fecha_v">---</td></tr>
            <tr><td>VENDEDOR:</td><td style="text-align: right;" id="tk_vendedor">---</td></tr>
        </table>
        
        <div style="border-top: 1px dashed #000; margin: 10px 0;"></div>
        
        <div style="font-weight: bold; font-size: 14px; text-align: center; margin-bottom: 5px;" id="tk_producto">---</div>
        <div style="text-align: center; margin-bottom: 10px;" id="tk_operador">---</div>
        
        <table style="width: 100%; border-collapse: collapse;">
            <tr><td>HUÉSPED:</td><td style="text-align: right;" id="tk_huesped">---</td></tr>
            <tr><td>HABITACIÓN:</td><td style="text-align: right;" id="tk_habitacion">---</td></tr>
            <tr><td>FECHA ACT.:</td><td style="text-align: right;" id="tk_fecha_a">---</td></tr>
            <tr><td>ADULTOS:</td><td style="text-align: right;" id="tk_adultos">---</td></tr>
            <tr id="tk_ninos_row"><td>NIÑOS:</td><td style="text-align: right;" id="tk_ninos">---</td></tr>
            <tr id="tk_grupos_row"><td>GRUPOS:</td><td style="text-align: right;" id="tk_grupos">---</td></tr>
        </table>

        <div id="tk_comments_wrap" class="d-none" style="margin-top: 5px; font-size: 10px; font-style: italic; border: 1px solid #ccc; padding: 5px;">
            <strong>OBSERVACIONES:</strong> <span id="tk_comments">---</span>
        </div>
        
        <div style="border-top: 1px dashed #000; margin: 10px 0;"></div>
        
        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px;">
            <span>TOTAL:</span>
            <span id="tk_total">0.00€</span>
        </div>
        
        <div style="text-align: center; margin-top: 5px; font-weight: bold; text-transform: uppercase;" id="tk_estado">COBRADO</div>
        
        <div style="margin-top: 20px; text-align: center; font-size: 10px;">
            ¡Disfrute de su actividad!<br>
            Gracias por confiar en nosotros.
        </div>
    </div>
</div>
