<h4 class="module-title-discrete px-3"><i class="bi bi-grid-3x3-gap"></i>Rack de Habitaciones</h4>

<!-- Module Toolbar (Print) -->
<div class="module-toolbar d-flex justify-content-end align-items-center p-2 mb-3 border-bottom d-print-none">
    <div class="btn-print-wrapper gap-2">
        <button class="btn btn-primary btn-sm fw-bold" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Rack">
            <i class="bi bi-printer me-2"></i>Imprimir Rack
        </button>
    </div>
</div>

<div class="row h-100 g-0">
    <!-- Sidebar Filters -->
    <div class="col-md-3 col-lg-2 bg-light border-end p-3 overflow-auto d-print-none" style="height: calc(100vh - 120px);">
        
        <!-- Search Input -->
        <div class="mb-4">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-search"></i>Buscar</h6>
            <input type="search" id="room-search-input" class="form-control" placeholder="Buscar habitación..." autocomplete="off">
        </div>

        <h6 class="sub-title-dynamic mb-3 border-top pt-3"><i class="bi bi-funnel-fill"></i>Filtros</h6>
        
        <div class="d-grid gap-2 mb-4">
            <button class="btn btn-sm btn-outline-secondary" id="btn-reset-filters">
                <i class="bi bi-arrow-counterclockwise me-1"></i>Limpiar Filtros
            </button>
        </div>

        <!-- Tipos -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Tipo de Habitación</h6>
            <div id="filter-tipos-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Estados -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Estado</h6>
            <div id="filter-estados-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Vistas -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Vistas</h6>
            <div id="filter-vistas-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Extras -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Características</h6>
            <div id="filter-extras-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <div class="alert alert-info small mt-4 p-2">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando <strong id="rack-count-display">0</strong> habitaciones
        </div>
    </div>

    <!-- Main Rack Grid -->
    <div class="col-md-9 col-lg-10 p-0 bg-white overflow-auto" style="height: calc(100vh - 120px);">
        <!-- Print Header (Hidden on screen) -->
        <div class="report-header-print d-none d-print-block p-4 mb-2">
            <div class="d-flex justify-content-between align-items-end border-bottom pb-2">
                <div>
                    <h2 class="m-0 text-primary">RACK DE HABITACIONES</h2>
                    <p class="m-0 text-muted">Hotel Garoé - Estado Actual</p>
                </div>
                <div class="text-end small">
                    <div><strong>Fecha:</strong> <span id="print-date-rack"></span></div>
                </div>
            </div>
        </div>
        
        <div class="px-4 pt-3 pb-0 no-print">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-grid-3x3-gap"></i>Estado de Habitaciones</h6>
        </div>

        <div class="p-4 pt-0" id="rack-grid-container">
            <!-- Grid injected by JS -->
        </div>
    </div>
</div>

<!-- Room Details Modal -->
<div class="modal fade" id="roomDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-door-open me-2"></i>Habitación <span id="modal-room-number"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="room-details-form">
                    <fieldset id="room-details-fieldset" disabled>
                    <!-- Read-only Info -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Tipo de habitación">Tipo</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-type" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Vista principal">Vista</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-view" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                    </div>

                    <!-- Editable Status -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase" data-bs-toggle="tooltip" title="Estado actual de limpieza/ocupación">Estado</label>
                        <select class="form-select" id="modal-room-status" data-bs-toggle="tooltip" title="Selecciona el estado de la habitación">
                            <option value="DISPONIBLE" class="text-success fw-bold">Disponible</option>
                            <option value="BLOQUEADA" class="text-danger fw-bold">Bloqueada / Fuera de servicio</option>
                        </select>
                    </div>

                    <!-- Editable Comments -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase">Observaciones</label>
                        <textarea class="form-control" id="modal-room-comments" rows="3" placeholder="Añadir notas sobre la habitación..." data-bs-toggle="tooltip" title="Escribe aquí observaciones internas sobre la habitación"></textarea>
                    </div>

                    <!-- Toggle Features (Manual Overrides) -->
                     <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase mb-2" data-bs-toggle="tooltip" title="Modificar características manualmente">Características Extra (Override)</label>
                        <div class="d-flex flex-wrap gap-2">
                             <input type="checkbox" class="btn-check" id="check-sofa" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofa" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá"><i class="bi bi-journal-bookmark-fill me-1"></i>Sofá</label>

                             <input type="checkbox" class="btn-check" id="check-sofaCama" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofaCama" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá Cama"><i class="bi bi-archive-fill me-1"></i>Sofá Cama</label>

                             <input type="checkbox" class="btn-check" id="check-cheslong" autocomplete="off">
                             <label class="btn btn-outline-primary btn-sm" for="check-cheslong" data-bs-toggle="tooltip" data-bs-title="Habitación con Cheslong"><i class="bi bi-layout-sidebar me-1"></i>Cheslong</label>

                             <input type="checkbox" class="btn-check" id="check-ruidosa" autocomplete="off">
                             <label class="btn btn-outline-secondary btn-sm" for="check-ruidosa" data-bs-toggle="tooltip" data-bs-title="Habitación Ruidosa"><i class="bi bi-speaker-fill me-1"></i>Ruidosa</label>

                             <input type="checkbox" class="btn-check" id="check-tranquila" autocomplete="off">
                             <label class="btn btn-outline-success btn-sm" for="check-tranquila" data-bs-toggle="tooltip" data-bs-title="Habitación Tranquila"><i class="bi bi-soundwave me-1"></i>Tranquila</label>
                        </div>
                        <div class="form-text small mt-1">
                            <i class="bi bi-info-circle me-1"></i>Estas casillas permiten sobrescribir manualmente si una habitación tiene un extra que no está en la base de datos.
                        </div>
                    </div>
                    </fieldset> <!-- Closed Fieldset here to prevent disabling security inputs -->
                </form>

                <!-- Security Access Section -->
                <form onsubmit="return false;">
                    <div id="security-check-container" class="mt-4 border-top pt-3">
                        <label class="form-label small fw-bold text-danger"><i class="bi bi-shield-lock-fill me-1"></i>Seguridad Requerida</label>
                        <div class="input-group input-group-sm mb-2">
                            <input type="password" class="form-control" id="security-pin-input" placeholder="Introducir código para editar" autocomplete="off" data-bs-toggle="tooltip" title="Introduce el código de supervisor">
                            <button class="btn btn-outline-danger" type="button" id="btn-unlock-details" data-bs-toggle="tooltip" title="Desbloquear edición de formulario">
                                <i class="bi bi-unlock-fill me-1"></i>Desbloquear
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn-save-room-details" disabled onclick="window.saveRoomDetails()" data-bs-toggle="tooltip" title="Guardar cambios permanentemente">
                    <i class="bi bi-save me-1"></i>Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>
