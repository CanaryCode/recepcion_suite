<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reception Suite - Hotel Garoé</title>
    <link rel="icon" href="resources/icono.ico" type="image/x-icon">
    <link href="assets/vendor/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/vendor/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style id="nuclear-ui-fixes">
        /* TARGETED OVERFLOW FIX */
        #dashboard-resumen-seccion .card, 
        #dashboard-resumen-seccion .card-body, 
        #dashboard-resumen-seccion .table-responsive {
            overflow: visible !important;
        }
        
        /* Ensure specific dropdowns have high z-index but retain positioning */
        .dropdown-menu {
            z-index: 9999 !important;
        }

        /* Fix for rooms that might have pointer-events disabled by tooltips */
        .room-card, .rack-box {
            pointer-events: auto !important;
            cursor: pointer !important;
        }
    </style>
    <link rel="stylesheet" href="assets/css/styles.css?v=FINAL_FIX_V2">
    <!-- CARGA DIRECTA DE ESTILOS DE IMPRESIÓN (SIN CACHÉ) -->
    <link rel="stylesheet" href="assets/css/print.css" media="print">
    <!-- FIX FINAL LAYOUT: Carga forzada al final -->
    <link rel="stylesheet" href="assets/css/layout_fix.css?v=FINAL_FIX_V2">
    <!-- MÓDULO DE IMPRESIÓN -->
    <link rel="stylesheet" href="assets/css/modules/impresion.css?v=V125_FIX">
    <script>
    </script>
    <script src="assets/vendor/chart.min.js"></script>
    <!-- Librería para generar PDF directamente -->
    <script src="assets/vendor/html2pdf.bundle.min.js"></script>
</head>

<body data-new-gr-c-s-check-loaded="14.1209.0" data-gr-ext-installed="">
    <!-- NOTIFICACIONES TOAST (Ref: toast-container) -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 10700;"></div>


    <!-- CAJA DE ERRORES GLOBAL -->
    <div id="global-error-box" class="position-fixed top-0 start-50 translate-middle-x mt-2 p-3 bg-danger text-white rounded shadow-lg d-none" style="z-index: 100000; max-width: 90vw;">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0"><i class="bi bi-bug-fill me-2"></i>ERRORES DEL SISTEMA</h6>
            <button class="btn-close btn-close-white btn-sm" onclick="this.parentElement.parentElement.classList.add('d-none')"></button>
        </div>
        <div id="error-list-content" class="small"></div>
    </div>

    <!-- GLOBAL HIDDEN TRIGGER FOR ALARMS TAB -->
    <button id="trigger-system-alarms-tab" class="d-none" data-bs-toggle="tab" data-bs-target="#system-alarms-content"></button>

    <!-- UI STRUCTURE -->
    <div id="app-layout" class="container py-4">

        <!-- App Header Panel -->
        <div class="app-header-panel text-center">
            <h1 class="display-5 fw-bold mb-2">Recepción Suite</h1>
            <p class="mb-0">by A. Jesús</p>
        </div>

        <!-- Cabecera Flexible: Navegación + Herramientas [CENTRADO] -->
        <div id="navbar-container" class="mb-3 border-bottom pb-1">
            <!-- Navegación por Pestañas -->
            <ul class="nav nav-tabs border-0" id="mainTabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                        data-bs-target="#dashboard-content" type="button">
                        <span class="custom-tooltip" data-bs-placement="right" data-bs-title="Panel Principal">
                            <i class="bi bi-house-door-fill me-1"></i> Inicio
                        </span>
                    </button>
                </li>


                <li class="nav-item dropdown">
                    <button class="nav-link dropdown-toggle btn btn-link" data-bs-toggle="dropdown" type="button">
                        <span data-tooltip="true" data-bs-placement="bottom" data-bs-title="Módulos Operativos">
                            <i class="bi bi-person-walking me-1"></i> Operaciones
                        </span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#despertadores-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Gestionar llamadas de despertador"><i class="bi bi-alarm me-2"></i>Despertadores</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#desayuno-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Listado de desayunos fuera de hora"><i class="bi bi-egg-fried me-2"></i>Desayuno Temprano</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#cena-fria-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Listado de cenas para llegadas tardías"><i class="bi bi-moon-stars me-2"></i>Cenas Frías</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#atenciones-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Gestión de detalles y cortesías"><i class="bi bi-gift me-2"></i>Atenciones</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#transfers-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Reservas de taxi y traslados"><i class="bi bi-taxi-front me-2"></i>Taxis & Transfers</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#lost-found-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Gestión de objetos perdidos"><i class="bi bi-box-seam me-2"></i>Objetos Perdidos</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#excursiones-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Venta de excursiones y tickets"><i class="bi bi-ticket-perforated me-2"></i>Venta Excursiones</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#reservas-instalaciones-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Reservas de pistas de tenis, gimnasio, etc."><i class="bi bi-calendar-check me-2"></i>Reservas Instalaciones</span>
                        </button></li>
                        <!-- Nuevo Módulo Impresión -->
                        <li><button class="dropdown-item" id="nav-impresion-tab" data-bs-toggle="tab" data-bs-target="#impresion-content" onclick="import('./assets/js/modules/Impresion.js?v=V140_MODS').then(m => m.inicializarImpresion())">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Impresión de documentos operativos (Tarjetero, etc.)"><i class="bi bi-printer me-2"></i>Impresión Documentos</span>
                        </button></li>
                        <!-- Nuevo Módulo Vales -->
                        <li><button class="dropdown-item" id="nav-vales-tab" data-bs-toggle="tab" data-bs-target="#vales-content" onclick="import('./assets/js/modules/vales.js').then(m => m.initVales())">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Gestión y emisión de vales de caja"><i class="bi bi-receipt me-2"></i>Control de Vales</span>
                        </button></li>
                        <!-- Movido desde Administración -->
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#safe-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Alquiler y control de cajas fuertes"><i class="bi bi-safe2 me-2"></i>Control de Safe</span>
                        </button></li>
                    </ul>
                </li>



                <li class="nav-item dropdown">
                    <button class="nav-link dropdown-toggle btn btn-link" data-bs-toggle="dropdown" type="button">
                        <span data-tooltip="true" data-bs-placement="bottom" data-bs-title="Gestión de Huéspedes">
                            <i class="bi bi-graph-up-arrow me-1"></i> Gestión
                        </span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#riu-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Fidelización y tarjetas RIU Class"><i class="bi bi-credit-card-2-front me-2"></i>Gestión RIU Class</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#estancia-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Estadísticas y control de ocupación"><i class="bi bi-bar-chart-line me-2"></i>Control Estancia</span>
                        </button></li>
                        <!-- Movido desde Administración -->
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item" onclick="abrirCaja()">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Cierre de caja y arqueo diario"><i class="bi bi-cash-coin me-2"></i>Cierre de Caja</span>
                        </button></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <button class="nav-link dropdown-toggle btn btn-link" data-bs-toggle="dropdown" type="button">
                        <span data-tooltip="true" data-bs-placement="bottom" data-bs-title="Consultas">
                            <i class="bi bi-life-preserver me-2"></i> Consultas
                        </span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#ayuda-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Manuales y procedimientos de recepción"><i class="bi bi-journal-check me-2"></i>Guías Operativas</span>
                        </button></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#precios-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Tarifas de servicios y extras"><i class="bi bi-tags-fill me-2"></i>Lista de Precios</span>
                        </button></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#rack-content">
                            <span data-tooltip="true" data-bs-placement="right" data-bs-title="Vista visual del estado de las habitaciones"><i class="bi bi-grid-3x3-gap-fill me-2"></i>Rack de Habitaciones</span>
                        </button></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <button class="nav-link dropdown-toggle btn btn-link" data-bs-toggle="dropdown" type="button">
                        <span data-tooltip="true" data-bs-placement="bottom" data-bs-title="Herramientas del Sistema">
                            <i class="bi bi-hdd-network me-2"></i> Sistema
                        </span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><button class="dropdown-item text-primary" onclick="window.ejecutarRespaldoManual()">
                            <span data-tooltip="true" data-bs-placement="left" data-bs-container="body" data-bs-title="Forzar copia manual al servidor"><i class="bi bi-cloud-arrow-up-fill me-2"></i>Forzar Respaldo</span>
                        </button></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item text-secondary" onclick="window.ejecutarRestauracionAgenda()">
                            <span data-tooltip="true" data-bs-placement="left" data-bs-container="body" data-bs-title="Añadir contactos originales que falten"><i class="bi bi-bandaid mb-1 me-2"></i>Recuperar Contactos Base</span>
                        </button></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#configuracion-content">
                            <span data-tooltip="true" data-bs-placement="left" data-bs-container="body" data-bs-title="Editar ajustes del sistema"><i class="bi bi-gear-wide-connected me-2"></i>Configuración</span>
                        </button></li>
                    </ul>
                </li>




                
                <!-- Buscador y Controles - Separados para mejor alineación -->
                
                <!-- 1. Alarma (Empuja a la derecha con ms-auto) -->
                <li class="nav-item ms-auto d-flex align-items-center">
                    <button class="btn btn-link text-secondary position-relative p-0 mx-2" id="btnSystemAlarms" 
                            data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-container="body" data-bs-title="Alarmas del Sistema">
                        <i class="bi bi-bell-fill fs-5"></i>
                        <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle d-none" id="badgeSystemAlarms">
                            <span class="visually-hidden">New alerts</span>
                        </span>
                    </button>
                </li>

                <!-- 2. Usuario Global -->
                <li class="nav-item d-flex align-items-center">
                    <div class="dropdown mx-1">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="globalUserBtn"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle me-1"></i> <span id="globalUserName" class="custom-tooltip" data-bs-title="Seleccionar Usuario">Usuario</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="globalUserBtn"
                            id="globalUserList">
                            <li><hr class="dropdown-divider"></li>
                            <li><button class="dropdown-item text-danger" onclick="window.logoutGlobal()"><i
                                        class="bi bi-box-arrow-right me-2"></i>Desconectar</button></li>
                        </ul>
                    </div>
                </li>

                <!-- 3. Buscador Global -->
                <li class="nav-item d-flex align-items-center">
                    <div class="nav-search-wrapper mx-1">
                        <div class="input-group shadow-sm">
                            <span class="input-group-text bg-white border-end-0 p-2"><i
                                    class="bi bi-search text-muted"></i></span>
                            <input type="text" id="appGlobalSearchInput" class="form-control border-start-0 ps-0"
                                placeholder="Buscar..." autocomplete="off">
                        </div>
                        <div id="searchResults" class="search-results-dropdown d-none"></div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="tab-content" id="mainTabsContent">
            <!-- Nueva pestaña de Dashboard con CENTRADO -->
            <div class="tab-pane fade show active" id="dashboard-content" role="tabpanel">
                <div class="row g-3 py-2 justify-content-center" id="shortcuts-row">
                    <div class="col-md-12">
                        <h4 class="fw-bold text-secondary mb-2">Accesos Directos</h4>
                    </div>
                    
                    <!-- Static Shortcuts (Fallback if JS fails) -->
                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#cobro-content')" class="btn-shortcut shortcut-success"
                        data-bs-toggle="tooltip" data-bs-title="Registrar Cobro">
                            <i class="bi bi-calculator-fill"></i>
                            <span>Cobro a Cliente</span>
                        </a>
                    </div>
                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#novedades-content')" class="btn-shortcut shortcut-info"
                        data-bs-toggle="tooltip" data-bs-title="Libro de Novedades">
                            <i class="bi bi-journal-text"></i>
                            <span>Novedades</span>
                        </a>
                    </div>
                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#agenda-content')" class="btn-shortcut shortcut-primary"
                        data-bs-toggle="tooltip" data-bs-title="Agenda Telefónica">
                            <i class="bi bi-telephone-outbound"></i>
                            <span>Agenda</span>
                        </a>
                    </div>
                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#notas-content')" class="btn-shortcut shortcut-warning"
                        data-bs-toggle="tooltip" data-bs-title="Notas Informativas">
                            <i class="bi bi-journal-bookmark-fill"></i>
                            <span>Notas Permanentes</span>
                        </a>
                    </div>
                    
                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#gallery-content')" class="btn-shortcut shortcut-purple"
                        data-bs-toggle="tooltip" data-bs-title="Galería de Información">
                            <i class="bi bi-images"></i>
                            <span>Galería Info</span>
                        </a>
                    </div>

                    <div class="col-6 col-md">
                        <a href="#" onclick="navegarA('#aplicaciones-content')" class="btn-shortcut shortcut-dark"
                        data-bs-toggle="tooltip" data-bs-title="Abrir Lanzador de Aplicaciones">
                            <i class="bi bi-grid-3x3-gap-fill"></i>
                            <span>Apps & Herramientas</span>
                        </a>
                    </div>
                </div>

                <!-- Sección de Resumen del Día Centrada -->
                <div class="row g-3 justify-content-center mt-2" id="dashboard-resumen-seccion">
                    <div class="col-md-12">
                        <h4 class="fw-bold text-secondary mb-2">Resumen del Día</h4>
                    </div>

                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-despertadores">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#despertadores-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Despertadores Pendientes">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-alarm me-2"></i>Despertadores</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-warning text-dark" id="dash-count-despertadores">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-despertadores"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-novedades">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#novedades-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Novedades del Día">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-journal-text me-2"></i>Novedades</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-info" id="dash-count-novedades">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-novedades"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-cenas">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#cena-fria-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Cenas Frías">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-moon-stars me-2"></i>Cenas Frías</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-primary" id="dash-count-cenas"
                                        style="background-color: #6610f2 !important;">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-cenas"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-desayunos">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#desayuno-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Desayunos Tempranos">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-egg-fried me-2"></i>Desayunos</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-danger" id="dash-count-desayunos">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-desayunos"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-transfers">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#transfers-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Transfers y Taxis">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-taxi-front me-2"></i>Transfers</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-primary" id="dash-count-transfers">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-transfers"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- WIDGET ATENCIONES -->
                    <div class="col-md-6 col-xl-3 d-none" id="dash-col-atenciones">
                        <div class="card border-0 shadow-sm h-100" style="cursor: pointer;"
                            onclick="if(!event.target.closest('tr')) navegarA('#atenciones-content')"
                            data-bs-toggle="tooltip" data-bs-title="Ver Atenciones VIP">
                            <div class="card-header border-0 py-2 d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 fw-bold"><i class="bi bi-gift me-2"></i>Atenciones</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge bg-info text-dark" id="dash-count-atenciones">0</span>
                                </div>
                            </div>
                            <div class="card-body p-0 overflow-auto" style="max-height: 200px;">
                                <table class="table table-sm table-hover mb-0" style="font-size: 0.8rem;">
                                    <tbody id="dash-tabla-atenciones"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nueva pestaña de Aplicaciones -->
            <div class="tab-pane fade" id="aplicaciones-content" role="tabpanel">
                <div class="mt-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div id="tabsFilterContainer" class="btn-group btn-group-sm shadow-sm">
                            <button class="btn btn-outline-primary" id="btnFilterLaunchAll_Tab" onclick="filterLaunchPad('all', 'tab')">Todos</button>
                            <button class="btn btn-outline-primary active" id="btnFilterLaunchApps_Tab" onclick="filterLaunchPad('app', 'tab')">Apps</button>
                            <button class="btn btn-outline-primary" id="btnFilterLaunchFolders_Tab" onclick="filterLaunchPad('folder', 'tab')">Carpetas</button>
                            <button class="btn btn-outline-primary" id="btnFilterLaunchMaps_Tab" onclick="filterLaunchPad('maps', 'tab')">Mapas</button>
                            <button class="btn btn-outline-primary" id="btnFilterLaunchDocs_Tab" onclick="filterLaunchPad('documentos', 'tab')">Documentos</button>
                            <button class="btn btn-outline-primary" id="btnFilterLaunchVideos_Tab" onclick="filterLaunchPad('video', 'tab')">Videos</button>
                            <button class="btn btn-outline-primary" id="btnFilterLaunchUrls_Tab" onclick="filterLaunchPad('url', 'tab')">Webs</button>
                        </div>
                        <div style="max-width: 300px;" class="input-group input-group-sm">
                            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
                            <input type="text" id="launchPadSearch_Tab" class="form-control border-start-0" placeholder="Buscar..." onkeyup="renderLaunchPad(this.value, window._currentLaunchPadFilter, 'tab')">
                        </div>
                    </div>
                    <div id="launchPadGrid_Tab" class="row g-3 py-2">
                        <!-- Se llena vía JS -->
                    </div>
                </div>
            </div>


            <!-- NUEVO MÓDULO VALES -->
            <div class="tab-pane fade" id="vales-content" role="tabpanel">
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2 text-muted">Cargando Módulo de Vales...</p>
                </div>
            </div>

            <div class="tab-pane fade" id="riu-content" role="tabpanel">
                <!-- Loaded via CompLoader from assets/templates/riu.html -->
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2 text-muted">Cargando Gestión RIU Class...</p>
                </div>
            </div>

            <div class="tab-pane fade" id="agenda-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Agenda de Contactos</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-agenda"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-telephone-outbound-fill"></i>Agenda Telefónica</h4>

<div class="module-toolbar d-flex justify-content-between align-items-center p-2 mb-3 no-print">
    <!-- View Toggles -->
    <div class="btn-group shadow-sm" role="group">
        <button type="button" class="btn btn-outline-primary active fw-bold" id="btnVistaTrabajoAgenda"
            data-bs-toggle="tooltip" data-bs-title="Formulario y Contactos">
            <i class="bi bi-pencil-square me-2"></i>Edición
        </button>
        <button type="button" class="btn btn-outline-primary fw-bold" id="btnVistaListaAgenda"
            data-bs-toggle="tooltip" data-bs-title="Solo Lista de Contactos">
            <i class="bi bi-list-ul me-2"></i>Lista
        </button>
        <button type="button" class="btn btn-outline-primary fw-bold" id="btnVistaRackAgenda"
            data-bs-toggle="tooltip" data-bs-title="Vista de Tarjetas">
            <i class="bi bi-grid-3x3-gap-fill me-2"></i>Rack
        </button>
    </div>

    <!-- Actions: Export & Print -->
    <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm fw-bold shadow-sm" onclick="exportarAgendaCSV()"
            data-bs-toggle="tooltip" data-bs-title="Exportar a CSV">
            <i class="bi bi-file-earmark-excel me-2"></i>Exportar
        </button>
        <div class="btn-print-wrapper">
            <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="window.print()"
                data-bs-toggle="tooltip" data-bs-title="Imprimir Agenda">
                <i class="bi bi-printer me-2"></i>Imprimir
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4" id="formAgenda-col">
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3">
                 <h6 class="sub-title-dynamic mb-0"><i class="bi bi-person-plus"></i>Nuevo Contacto</h6>
            </div>
            <form id="formAgenda" class="card-body p-3">
                <div class="row g-2 mb-2">
                    <div class="col-6">
                        <label class="form-label small mb-0">Prioridad *</label>
                        <select id="agenda_categoria" class="form-select form-select-sm" data-bs-toggle="tooltip" data-bs-title="Tipo de Prioridad">
                            <option value="Común">Común</option>
                            <option value="Urgencia">Urgencia</option>
                            <option value="Información">Información</option>
                            <option value="Extensión">Extensión</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="form-label small mb-0">Vínculo *</label>
                        <select id="agenda_vinculo" class="form-select form-select-sm" data-bs-toggle="tooltip" data-bs-title="Relación con el Contacto">
                            <option value="Trabajador">Trabajador</option>
                            <option value="Cliente">Cliente</option>
                            <option value="Empresa">Empresa</option>
                            <option value="Hotel">Hotel</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="mb-2">
                    <label class="form-label small mb-0">Nombre *</label>
                    <input type="text" id="agenda_nombre" class="form-control form-control-sm" required
                        data-bs-toggle="tooltip" data-bs-title="Nombre del Contacto">
                </div>
                <div id="telefonos-wrapper" class="mb-2"></div>
                <div class="mb-2">
                    <label class="form-label small mb-0">Email</label>
                    <input type="email" id="agenda_email" class="form-control form-control-sm"
                        data-bs-toggle="tooltip" data-bs-title="Correo Electrónico">
                </div>
                <div class="mb-2">
                    <label class="form-label small mb-0">Web</label>
                    <input type="url" id="agenda_web" class="form-control form-control-sm"
                        data-bs-toggle="tooltip" data-bs-title="Sitio Web">
                </div>
                <div id="direccion-wrapper" class="row g-1 mb-2">
                    <div class="col-4">
                        <label class="form-label small mb-0">País</label>
                        <input type="text" id="agenda_pais" class="form-control form-control-sm">
                    </div>
                    <div class="col-4">
                        <label class="form-label small mb-0">Ciudad</label>
                        <input type="text" id="agenda_ciudad" class="form-control form-control-sm">
                    </div>
                    <div class="col-4">
                        <label class="form-label small mb-0">CP</label>
                        <input type="text" id="agenda_cp" class="form-control form-control-sm">
                    </div>
                    <div class="col-9">
                        <label class="form-label small mb-0">Calle</label>
                        <input type="text" id="agenda_calle" class="form-control form-control-sm">
                    </div>
                    <div class="col-3">
                        <label class="form-label small mb-0">Nº</label>
                        <input type="text" id="agenda_numero_calle" class="form-control form-control-sm">
                    </div>
                </div>
                <div class="mb-2">
                    <label class="form-label small mb-0">Comentarios</label>
                    <textarea id="agenda_comentarios" class="form-control form-control-sm" rows="2"
                        data-bs-toggle="tooltip" data-bs-title="Notas Adicionales"></textarea>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div class="form-check mb-0">
                        <input type="checkbox" class="form-check-input" id="agenda_favorito">
                        <label class="form-check-label small" for="agenda_favorito">Favorito</label>
                    </div>
                    <button type="submit" id="btnAgendaSubmit" class="btn btn-primary btn-sm px-4" data-bs-toggle="tooltip" data-bs-title="Guardar Nuevo Contacto"><i class="bi bi-person-plus-fill me-2"></i>Guardar
                        Contacto</button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-md-8" id="agenda-list-col">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="sub-title-dynamic mb-0"><i class="bi bi-list-ul"></i>Contactos (<span id="totalContactos">0</span>)</h6>
                <!-- Eliminados Search y Export de aquí -->
            </div>
            <!-- BARRA DE FILTROS Y ORDENACIÓN REDISEÑADA -->
            <div class="card-body bg-light border-bottom p-3">
                <div class="row g-3">
                    <!-- Fila 1: Búsqueda y Filtros Principales -->
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted mb-1">Buscar Global</label>
                        <input type="text" id="searchAgenda" class="form-control form-control-sm" placeholder="Nombre, Teléfono, Email...">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small fw-bold text-muted mb-1">Vínculo</label>
                        <select id="filterAgendaVinculo" class="form-select form-select-sm fw-bold">
                            <option value="">Todos</option>
                            <option value="Trabajador">Trabajador</option>
                            <option value="Cliente">Cliente</option>
                            <option value="Empresa">Empresa</option>
                            <option value="Hotel">Hotel</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small fw-bold text-muted mb-1">Prioridad</label>
                        <select id="filterAgendaCategoria" class="form-select form-select-sm fw-bold">
                            <option value="">Todas</option>
                            <option value="Urgencia">Urgencia</option>
                            <option value="Información">Información</option>
                            <option value="Extensión">Extensión</option>
                            <option value="Común">Común</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <div class="form-check form-switch w-100 border rounded bg-white py-1 px-3 mb-0" style="height: 31px; display: flex; align-items: center;">
                            <input class="form-check-input m-0 me-2" type="checkbox" role="switch" id="filterAgendaFavorito">
                            <label class="form-check-label small fw-bold text-warning" for="filterAgendaFavorito">Favoritos</label>
                        </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                         <button class="btn btn-sm btn-outline-secondary w-100 fw-bold" onclick="resetAgendaFilters()" style="height: 31px;">
                            <i class="bi bi-x-circle me-1"></i>Limpiar
                        </button>
                    </div>

                    <!-- Fila 2: Filtros Geográficos -->
                    <div class="col-md-3">
                         <label class="form-label small fw-bold text-muted mb-1">País</label>
                         <input type="text" id="filterAgendaPais" class="form-control form-control-sm" placeholder="España, +34...">
                    </div>
                    <div class="col-md-3">
                         <label class="form-label small fw-bold text-muted mb-1">Ciudad</label>
                         <input type="text" id="filterAgendaCiudad" class="form-control form-control-sm" placeholder="Santa Cruz, Adeje...">
                    </div>
                     <div class="col-md-6">
                         <!-- Espacio libre o información extra -->
                     </div>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 30%; cursor: pointer;" onclick="ordenarAgenda('nombre')">
                                Nombre / Contacto <i class="bi bi-arrow-down-up ms-1 small text-muted sort-icon" id="sort-icon-nombre"></i>
                            </th>
                            <th style="width: 12%; cursor: pointer;" onclick="ordenarAgenda('vinculo')">
                                Vínculo <i class="bi bi-arrow-down-up ms-1 small text-muted sort-icon" id="sort-icon-vinculo"></i>
                            </th>
                            <th style="width: 12%; cursor: pointer;" onclick="ordenarAgenda('categoria')">
                                Categoría <i class="bi bi-arrow-down-up ms-1 small text-muted sort-icon" id="sort-icon-categoria"></i>
                            </th>
                            <th style="width: 26%">Datos de Contacto</th>
                            <th style="width: 20%">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="agendaCuerpo"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid d-none" id="agenda-grid-view">
    <div class="row g-3" id="agendaItemsGrid">
        <!-- JS Injection -->
    </div>
</div>
<datalist id="paises-list"></datalist>
            </div>
            <div class="tab-pane fade" id="caja-content" role="tabpanel">
<div class="module-wrapper">
  <!-- VISTA WEB INTERACTIVA (Solo se ve en pantalla) -->
  <div class="no-print" id="caja-web-interactive-view">
    <h4 class="module-title-discrete text-end mb-2"><i class="bi bi-cash-coin"></i>Cierre de Caja</h4>
    <div class="module-toolbar d-flex justify-content-end mb-3">
      <div class="btn-print-wrapper d-flex gap-2">
        <button class="btn btn-danger btn-sm fw-bold" onclick="guardarCajaPDF()"><i class="bi bi-file-earmark-pdf me-1"></i>PDF</button>
        <button class="btn btn-info btn-sm fw-bold text-white" onclick="enviarCajaEmail()"><i class="bi bi-envelope me-1"></i>Email</button>
        <button class="btn btn-outline-primary btn-sm fw-bold shadow-sm px-3" onclick="imprimirCierreCaja()">
            <i class="bi bi-printer me-1"></i>Imprimir / Vista
        </button>
        <button class="btn btn-success btn-sm fw-bold shadow-sm px-3 border-2" onclick="cerrarCajaDefinitivo()">
            <i class="bi bi-check2-circle me-1"></i>CIERRE DEFINITIVO (Contabilizar)
        </button>
      </div>
    </div>

    <div class="row align-items-stretch g-3">
      <!-- Columna Principal (Web) -->
      <div class="col-md-8 d-flex flex-column">
        <!-- Datos de Fecha/Turno -->
        <div class="card mb-3 shadow-sm border-0">
          <div class="card-body py-2">
            <div class="row g-3 align-items-center">
              <div class="col-6">
                <label class="form-label small fw-bold text-muted mb-1"><i class="bi bi-calendar3 me-1"></i>FECHA CONTABLE</label>
                <div class="input-group input-group-sm">
                  <input type="date" id="caja_fecha" class="form-control fw-bold text-primary bg-white" readonly />
                  <button class="btn btn-outline-primary" type="button" onclick="toggleLockCaja('caja_fecha', this)"><i class="bi bi-lock-fill"></i></button>
                </div>
              </div>
              <div class="col-6">
                <label class="form-label small fw-bold text-muted mb-1">TURNO DETECTADO</label>
                <div class="input-group input-group-sm">
                  <select id="caja_turno" class="form-select fw-bold text-success bg-white" disabled>
                    <option value="MAÑANA">MAÑANA</option>
                    <option value="TARDE">TARDE</option>
                    <option value="NOCHE">NOCHE</option>
                  </select>
                  <button class="btn btn-outline-success" type="button" onclick="toggleLockCaja('caja_turno', this)"><i class="bi bi-lock-fill"></i></button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Efectivo -->
        <div class="card mb-3 shadow-sm border-0 flex-grow-1">
          <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="bi bi-calculator me-2"></i>Efectivo (Billetes, Monedas y Varios)</span>
            <div>
              <button class="btn btn-sm btn-success me-1 shadow-sm" onclick="agregarNuevoConcepto()"><i class="bi bi-plus-circle me-1"></i>Concepto</button>
              <button class="btn btn-sm btn-outline-danger border-0" onclick="resetearCaja()"><i class="bi bi-trash me-1"></i>Limpiar</button>
            </div>
          </div>
          <div class="card-body d-flex flex-column">
            <div class="row flex-grow-1">
              <div class="col-md-6 border-end" id="billetes-container">
                <h6 class="text-secondary fw-bold border-bottom pb-2 mb-3">Billetes</h6>
              </div>
              <div class="col-md-6" id="monedas-container">
                <h6 class="text-secondary fw-bold border-bottom pb-2 mb-3">Monedas</h6>
              </div>
            </div>
            <div class="mt-3 pt-3 border-top" id="otros-container">
              <h6 class="text-primary fw-bold mb-3 small"><i class="bi bi-sliders me-2"></i>OTROS CONCEPTOS</h6>
              <div class="row g-2 mb-2">
                  <div class="col-6">
                    <div class="input-group input-group-sm flex-nowrap">
                      <span class="input-group-text"><i class="bi bi-ticket-perforated me-2"></i>Vales</span>
                      <input type="text" id="caja_vales_total" class="form-control fw-bold bg-white text-primary text-center" value="0.00" readonly />
                      <button class="btn btn-outline-primary" type="button" onclick="abrirModalVales()"><i class="bi bi-pencil-square"></i></button>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="input-group input-group-sm flex-nowrap">
                      <span class="input-group-text"><i class="bi bi-dash-circle me-2"></i>Desemb.</span>
                      <input type="text" id="caja_desembolsos" class="form-control fw-bold bg-white text-primary text-center" value="0.00" readonly />
                      <button class="btn btn-outline-primary" type="button" onclick="abrirModalDesembolsos()"><i class="bi bi-pencil-square"></i></button>
                    </div>
                  </div>
              </div>
              <div class="row g-2">
                  <div class="col-6">
                    <div class="input-group input-group-sm">
                      <span class="input-group-text"><i class="bi bi-postage me-2"></i>Sellos</span>
                      <input type="number" id="caja_sellos_cant" class="form-control text-center" placeholder="Ej: 5" />
                      <input type="number" id="caja_sellos_precio" class="form-control text-center" value="2.00" />
                      <span class="input-group-text fw-bold text-primary bg-white" id="caja_sellos_total_lbl">0.00€</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="input-group input-group-sm flex-nowrap">
                      <span class="input-group-text"><i class="bi bi-safe me-2"></i>Safe</span>
                      <input type="number" id="caja_safe" class="form-control fw-bold text-primary text-center" placeholder="Total Safe" step="0.01" onchange="this.value = parseFloat(this.value || 0).toFixed(2)" />
                      <span class="input-group-text text-primary">€</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="input-group input-group-sm flex-nowrap">
                      <span class="input-group-text"><i class="bi bi-plus-circle me-2"></i>Extra</span>
                      <input type="number" id="caja_monedas_extra" class="form-control fw-bold text-primary text-center" placeholder="Ej: Bote" step="0.01" onchange="this.value = parseFloat(this.value || 0).toFixed(2)" />
                      <span class="input-group-text text-primary">€</span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="input-group input-group-sm flex-nowrap">
                      <span class="input-group-text fw-bold text-secondary"><i class="bi bi-bank me-2"></i>Fondo</span>
                      <input type="text" id="input_fondo_arqueo" class="form-control fw-bold text-primary bg-light text-center" value="-2000.00€" readonly />
                      <button class="btn btn-outline-secondary" type="button" onclick="toggleLockCaja('input_fondo_arqueo', this)"><i class="bi bi-lock-fill"></i></button>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Columna Lateral (Web) -->
      <div class="col-md-4 d-flex flex-column">
        <div class="card mb-3 shadow-sm border-0">
          <div class="card-body text-center">
            <h5 class="text-secondary"><i class="bi bi-wallet2 me-2"></i>Total Tesorería</h5>
            <h1 class="display-4 fw-bold text-dark" id="total_caja">0.00€</h1>
            <hr class="my-2" />
            <div class="d-flex justify-content-between small"><span>Billetes:</span><span id="subtotal_billetes" class="fw-bold text-primary">0.00€</span></div>
            <div class="d-flex justify-content-between small"><span>Monedas:</span><span id="subtotal_monedas" class="fw-bold text-primary">0.00€</span></div>
            <div class="d-flex justify-content-between small fw-bold border-top pt-1 mb-1 text-primary"><span>TOTAL EFECTIVO:</span><span id="total_efectivo">0.00€</span></div>
            <div class="d-flex justify-content-between small fw-bold text-primary"><span>OTROS CONCEPTOS:</span><span id="subtotal_otros">0.00€</span></div>
            <div class="p-3 rounded bg-primary bg-opacity-25 mt-4 border border-primary">
              <small class="text-info fw-bold"><i class="bi bi-graph-up-arrow me-1"></i>PRODUCCIÓN (VENTA)</small>
              <h2 class="fw-bold" id="recaudacion_caja">0.00€</h2>
            </div>
          </div>
        </div>
        <div class="card shadow-sm border-0 flex-grow-1 d-flex flex-column mb-4" id="card-comentarios-caja">
          <div class="card-body d-flex flex-column">
            <label class="small fw-bold text-muted mb-2"><i class="bi bi-chat-left-text me-2"></i>COMENTARIOS</label>
            <textarea id="caja_comentarios_cierre" class="form-control flex-grow-1" style="min-height: 150px" placeholder="Ej: Falta ticket de taxi, sobrante de 2€..."></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- VISTA DE IMPRESIÓN (HARDCODED TABLE - Solo se ve al imprimir) -->
  <div class="d-none d-print-block" id="caja-print-report-view" style="font-family: Arial, sans-serif;">
    <div class="report-header-print mb-4" style="border-bottom: 2px solid #333; padding-bottom: 10px; display: flex; justify-content: space-between;">
      <div>
          <h2 style="margin:0; color:#0d6efd;">CIERRE DE CAJA</h2>
          <p style="margin:0; color:#666;">Hotel Garoé - Módulo de Recepción</p>
      </div>
      <div style="text-align: right; font-size: 10pt;">
          <div><strong>Fecha:</strong> <span id="print-date-caja"></span></div>
          <div><strong>Turno:</strong> <span id="print-turno-label"></span></div>
          <div><strong>Recepcionista:</strong> <span id="print-repc-nombre-caja"></span></div>
      </div>
    </div>

    <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
      <tr>
        <!-- COLUMNA IZQUIERDA (Datos Detallados) -->
        <td style="width: 65%; vertical-align: top; padding-right: 20px;">
          <h5 style="background:#f8f9fa; padding:5px; border-bottom:1px solid #ccc; margin-top:0;"><i class="bi bi-calculator me-2"></i>DETALLE DE EFECTIVO</h5>
          <div style="display: flex;">
              <div style="flex: 1; padding-right:10px;" id="print-billetes-summary">
                  <h6 style="font-size: 9pt; margin-bottom: 5px; color:#555;"><i class="bi bi-cash me-2"></i>BILLETES</h6>
                  <!-- JS inyectará aquí el desglose completo -->
              </div>
              <div style="flex: 1;" id="print-monedas-summary">
                  <h6 style="font-size: 9pt; margin-bottom: 5px; color:#555;"><i class="bi bi-coin me-2"></i>MONEDAS</h6>
                  <!-- JS inyectará aquí el desglose completo -->
              </div>
          </div>

          <h5 style="background:#f8f9fa; padding:5px; border-bottom:1px solid #ccc; margin-top:20px;"><i class="bi bi-sliders me-2"></i>OTROS CONCEPTOS</h5>
          <table style="width: 100%; font-size: 10pt;">
              <!-- VALES -->
              <tr><td style="padding:4px 0;"><i class="bi bi-ticket-perforated me-2"></i>Vales Registrados:</td><td style="text-align:right; font-weight:bold;" id="print_vales_total">0.00€</td></tr>
              <tr><td colspan="2"><div id="print-vales-details" style="margin-bottom:5px; padding-left: 15px;"></div></td></tr>

              <!-- DESEMBOLSOS -->
              <tr><td style="padding:4px 0;"><i class="bi bi-dash-circle me-2"></i>Desembolsos:</td><td style="text-align:right; font-weight:bold;" id="print_desembolsos_total">0.00€</td></tr>
              <tr><td colspan="2"><div id="print-desembolsos-details" style="margin-bottom:5px; padding-left: 15px;"></div></td></tr>

              <!-- SELLOS -->
              <tr><td style="padding:4px 0;"><i class="bi bi-postage me-2"></i>Suma Sellos:</td><td style="text-align:right; font-weight:bold;" id="print_sellos_total">0.00€</td></tr>
              
              <!-- SAFE -->
              <tr><td style="padding:4px 0;"><i class="bi bi-safe me-2"></i>Safe:</td><td style="text-align:right; font-weight:bold;" id="print_safe_total">0.00€</td></tr>
              
              <!-- EXTRA -->
              <tr><td style="padding:4px 0;"><i class="bi bi-plus-circle me-2"></i>Extra / Otros:</td><td style="text-align:right; font-weight:bold;" id="print_monedas_extra_total">0.00€</td></tr>

              <!-- FONDO (AL FINAL) -->
              <tr><td style="padding:4px 0;"><i class="bi bi-bank me-2"></i>Fondo de Caja:</td><td style="text-align:right; font-weight:bold;" id="print_fondo_total">-2000.00€</td></tr>
          </table>
          
          <div id="print-dynamic-concepts" style="margin-top:10px; font-size: 10pt;"></div>
        </td>

        <!-- COLUMNA DERECHA (Totales y Comentarios) -->
        <td style="width: 35%; vertical-align: top; border-left: 2px solid #eee; padding-left: 20px;">
          <div style="background: #f1f8ff; padding: 15px; border-radius: 8px; border: 1px solid #cfe2ff; text-align: center;">
              <h4 style="margin:0; color:#004085; font-size: 11pt;"><i class="bi bi-wallet2 me-2"></i>TOTAL TESORERÍA</h4>
              <div style="font-size: 24pt; font-weight: bold; margin: 10px 0;" id="print_total_caja_main">0.00€</div>
              <hr style="border:0; border-top:1px solid #ccc;"/>
              <div style="display:flex; justify-content:space-between; font-size: 9pt; margin-bottom:4px;">
                  <span>Subtotal Efectivo:</span><span id="print_total_efectivo">0.00€</span>
              </div>
              <div style="display:flex; justify-content:space-between; font-size: 9pt;">
                  <span>Subtotal Otros:</span><span id="print_subtotal_otros">0.00€</span>
              </div>
              
              <div style="margin-top:20px; padding:10px; background:#e2f3e5; border-radius:5px;">
                  <div style="font-size: 8pt; font-weight:bold; color:#155724;"><i class="bi bi-graph-up-arrow me-1"></i>PRODUCCIÓN (VENTA)</div>
                  <div style="font-size: 16pt; font-weight:bold; color:#155724;" id="print_recaudacion_final">0.00€</div>
              </div>
          </div>

          <div style="margin-top:25px;">
              <label style="font-size: 8pt; font-weight:bold; color:#666; display:block; margin-bottom:5px;"><i class="bi bi-chat-left-text me-2"></i>OBSERVACIONES / COMENTARIOS</label>
              <div id="print-comentarios-caja" style="font-size: 9pt; line-height: 1.4; border: 1px solid #eee; padding: 10px; min-height: 150px; background: #fff; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word;"></div>
          </div>
        </td>
      </tr>
    </table>

    <div class="signature-area" style="margin-top: 50px; display: flex; justify-content: space-around; font-size: 9pt;">
      <div style="border-top: 1px solid #000; width: 150px; text-align: center; padding-top: 5px;">Firma Recepcionista</div>
      <div style="border-top: 1px solid #000; width: 150px; text-align: center; padding-top: 5px;">Firma Intervención</div>
    </div>
  </div>

  <!-- MODAL GESTIÓN DE VALES -->
  <div class="modal fade" id="modalVales" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-primary text-white">
          <h6 class="modal-title fw-bold"><i class="bi bi-ticket-perforated me-2"></i>Gestión de Vales</h6>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-light">
          <div class="card border-0 shadow-sm mb-3">
            <div class="card-body p-2">
              <form id="formAddVale" class="row g-2 align-items-end" onsubmit="agregarVale(event)">
                <div class="col-md-3">
                  <label class="small fw-bold text-muted">Receptor</label>
                  <input type="text" id="vale_receptor" class="form-control form-control-sm" placeholder="Nombre..." required />
                </div>
                <div class="col-md-4">
                  <label class="small fw-bold text-muted">Concepto</label>
                  <input type="text" id="vale_concepto" class="form-control form-control-sm" placeholder="Razón..." required />
                </div>
                <div class="col-md-3">
                  <label class="small fw-bold text-muted">Comentario</label>
                  <input type="text" id="vale_comentario" class="form-control form-control-sm" placeholder="Observaciones..." />
                </div>
                <div class="col-md-2">
                  <label class="small fw-bold text-muted">Importe (€)</label>
                  <div class="input-group input-group-sm">
                    <input type="number" id="vale_importe" class="form-control" step="0.01" min="0.01" placeholder="0.00" required />
                    <button class="btn btn-primary px-2" type="submit"><i class="bi bi-plus-lg"></i></button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <h6 class="small fw-bold text-muted mb-2">Vales Registrados</h6>
          <div class="list-group shadow-sm" id="listaVales">
            <div class="text-center py-3 text-muted small" id="noValesMsg">No hay vales registrados</div>
          </div>
        </div>
        <div class="modal-footer py-1">
          <span class="me-auto small fw-bold">Total Vales: <span id="modalValesTotal" class="text-primary">0.00€</span></span>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL GESTIÓN DE DESEMBOLSOS -->
  <div class="modal fade" id="modalDesembolsos" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-primary text-white">
          <h6 class="modal-title fw-bold"><i class="bi bi-dash-circle me-2"></i>Gestión de Desembolsos</h6>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-light">
          <div class="card border-0 shadow-sm mb-3">
            <div class="card-body p-2">
              <form id="formAddDesembolso" class="row g-2 align-items-end" onsubmit="agregarDesembolso(event)">
                <div class="col-8">
                  <label class="small fw-bold text-muted">Concepto / Motivo</label>
                  <input type="text" id="desembolso_concepto" class="form-control form-control-sm" placeholder="Ej: Pago Proveedor..." required />
                </div>
                <div class="col-4">
                  <label class="small fw-bold text-muted">Importe (€)</label>
                  <div class="input-group input-group-sm">
                    <input type="number" id="desembolso_importe" class="form-control" step="0.01" min="0.01" placeholder="0.00" required />
                    <button class="btn btn-primary" type="submit"><i class="bi bi-plus-lg"></i></button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <h6 class="small fw-bold text-muted mb-2">Desembolsos Registrados</h6>
          <div class="list-group shadow-sm" id="listaDesembolsos">
            <div class="text-center py-3 text-muted small" id="noDesembolsosMsg">No hay desembolsos registrados</div>
          </div>
        </div>
        <div class="modal-footer py-1">
          <span class="me-auto small fw-bold">Total Desembolsos: <span id="modalDesembolsosTotal" class="text-primary">0.00€</span></span>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>
            </div>
            <div class="tab-pane fade" id="lost-found-content" role="tabpanel">
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2 text-muted">Cargando Objetos Perdidos...</p>
                </div>
            </div>

            <div class="tab-pane fade" id="cobro-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Cobro</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-cobro"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-currency-exchange"></i>Cobro de Clientes</h4>

<div class="module-toolbar d-flex justify-content-end align-items-center p-2 mb-3 no-print">
    <div class="btn-print-wrapper">
        <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Recibo">
            <i class="bi bi-printer me-2"></i>Imprimir Recibo
        </button>
    </div>
</div>

<div class="row g-2">
    <!-- COLUMNA PRINCIPAL CALCULADORA (Billetes y Monedas) -->
    <div class="col-md-9">
        <div class="card mb-3 shadow-sm border-0">
            <div class="card-header d-flex justify-content-between align-items-center py-3 bg-white border-bottom">
                <h6 class="sub-title-dynamic mb-0"><i class="bi bi-calculator"></i>Calculadora de Cambio</h6>
                <button class="btn btn-sm btn-outline-primary shadow-sm fw-bold px-3 py-1" style="font-size: 0.75rem;" onclick="resetearCobro()">
                    <i class="bi bi-arrow-repeat me-1"></i>Nueva Operación
                </button>
            </div>
            <div class="card-body p-3">
                <div class="row g-3">
                    <!-- SECCIÓN RECIBIDO -->
                    <div class="col-md-6 border-end">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-arrow-down-circle text-success me-2"></i>
                            <span class="fw-bold small text-uppercase text-success">1. Dinero Recibido</span>
                        </div>
                        <div class="row g-2">
                            <div class="col-6" id="recibido-billetes">
                                <label class="small text-muted d-block mb-1 border-bottom" style="font-size: 0.7rem;">BILLETES</label>
                            </div>
                            <div class="col-6" id="recibido-monedas">
                                <label class="small text-muted d-block mb-1 border-bottom" style="font-size: 0.7rem;">MONEDAS</label>
                            </div>
                        </div>
                    </div>
                    <!-- SECCIÓN ENTREGADO -->
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-arrow-up-circle text-danger me-2"></i>
                            <span class="fw-bold small text-uppercase text-danger">2. Cambio Entregado</span>
                        </div>
                        <div class="row g-2">
                            <div class="col-6" id="entregado-billetes">
                                <label class="small text-muted d-block mb-1 border-bottom" style="font-size: 0.7rem;">BILLETES</label>
                            </div>
                            <div class="col-6" id="entregado-monedas">
                                <label class="small text-muted d-block mb-1 border-bottom" style="font-size: 0.7rem;">MONEDAS</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- COLUMNA LATERAL RESUMEN -->
    <div class="col-md-3">
        <div class="mb-3">
            <label class="form-label small fw-bold text-primary mb-1 text-uppercase" style="font-size: 0.65rem;">Total a Cobrar (€)</label>
            <input type="number" step="0.01" id="cobro_total_a_cobrar"
                class="form-control form-control-lg border-primary fw-bold text-center shadow-sm" style="font-size: 2rem; height: 60px;" placeholder="0.00">
        </div>

        <div class="card shadow-sm border-warning">
            <div class="card-body p-3 text-center">
                <h6 class="text-secondary small mb-1"><i class="bi bi-wallet2 me-2"></i>RESUMEN</h6>
                <div class="mb-2">
                    <small class="text-muted d-block" style="font-size: 0.7rem;">Cambio a Devolver</small>
                    <h3 class="fw-bold text-warning mb-0" id="cobro_cambio_deber">0.00€</h3>
                </div>
                <hr class="my-2">
                <div class="mb-3 p-2 rounded bg-secondary bg-opacity-10">
                    <small class="d-block mb-1 text-uppercase" style="font-size: 0.6rem; letter-spacing: 1px;">Diferencia Final</small>
                    <h2 class="fw-bold mb-0" id="cobro_diferencia_final" style="font-size: 1.5rem;">0.00€</h2>
                    <div id="cobro_status_msg" class="mt-1" style="font-size: 0.7rem;"></div>
                </div>
                <div id="sugerencia-cambio-container" class="alert alert-info p-2 mb-0 d-none shadow-sm" style="font-size: 0.75rem;"></div>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="safe-content" role="tabpanel">
                <!-- Loaded via CompLoader -->
            </div>

            <div class="tab-pane fade" id="lost-found-content" role="tabpanel">
                <!-- Loaded via CompLoader -->
            </div>

            <div class="tab-pane fade" id="excursiones-content" role="tabpanel">
                <!-- Loaded via CompLoader -->
            </div>

            <div class="tab-pane fade" id="reservas-instalaciones-content" role="tabpanel">
                <!-- Loaded via CompLoader from assets/templates/reservas_instalaciones.html -->
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2 text-muted">Cargando Reservas de Instalaciones...</p>
                </div>
            </div>
            <div class="tab-pane fade" id="despertadores-content" role="tabpanel">
<div class="d-none report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Despertadores</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-despertadores"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-despertadores"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-alarm-fill"></i>Reporte de Despertadores</h4>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoDesp"
            data-bs-toggle="tooltip" data-bs-title="Ver Formulario y Lista">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaRackDesp"
            data-bs-toggle="tooltip" data-bs-title="Ver Resumen por Habitaciones">
            <i class="bi bi-grid-3x3-gap me-2"></i>Vista de Rack
        </button>
    </div>
    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirDespertadores()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Informe de Despertadores">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<!-- VISTA DE TRABAJO -->
<div id="despertadores-trabajo">
    <div class="card mb-4 shadow-sm border-0 no-print">
        <div class="card-header py-3">
            <h6 class="sub-title-dynamic mb-0"><i class="bi bi-alarm"></i>Programar Despertador</h6>
        </div>
        <div class="card-body">
            <form id="formNuevoDespertador" class="row g-3 align-items-end">
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Habitación</label>
                    <input type="text" id="desp_hab" class="form-control" placeholder="Ej: 101" required
                        list="lista-habs-desp" data-bs-toggle="tooltip" data-bs-title="Número de Habitación">
                    <datalist id="lista-habs-desp"></datalist>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Hora</label>
                    <input type="time" id="desp_hora" class="form-control" required
                        data-bs-toggle="tooltip" data-bs-title="Hora del Despertador">
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold">Comentario / Nota</label>
                    <textarea id="desp_comentario" class="form-control" rows="2"
                        placeholder="Ej: Llamar dos veces, habla inglés..."
                        data-bs-toggle="tooltip" data-bs-title="Indica detalles especiales si es necesario"></textarea>
                </div>
                <div class="col-12 d-flex justify-content-end align-items-center gap-2 mt-2">
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="limpiarDespertadoresPasados()"
                        data-bs-toggle="tooltip" data-bs-title="Eliminar Despertadores ya Ejecutados">
                        <i class="bi bi-trash me-1"></i>Limpiar Pasados
                    </button>
                    <button type="submit" id="btnSubmitDespertador" class="btn btn-primary btn-sm px-4 fw-bold shadow-sm" data-bs-toggle="tooltip" data-bs-title="Guardar Despertador">
                        <i class="bi bi-alarm-fill me-2"></i>Programar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold">Llamadas Pendientes</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Habitación</th>
                        <th>Hora</th>
                        <th>Comentario</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaDespertadoresActivos"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- VISTA DE RACK -->
<div id="despertadores-rack" class="d-none">
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <h6 class="fw-bold text-muted mb-3 small">RESUMEN DE DESPERTADORES</h6>
            <div id="desp-stats" class="row g-2">
                <!-- Inyectado por JS -->
            </div>
        </div>
    </div>
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div id="rack-desp-habitaciones" class="d-flex flex-wrap gap-1 justify-content-start"></div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="novedades-content" role="tabpanel">
<div class="d-none report-header-print">
    <div class="report-info-left">
        <h2>Libreta de Novedades</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-novedades"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-novedades"></span></div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-calendar-check-fill"></i>Libro de Novedades</h4>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoNov"
            data-bs-toggle="tooltip" data-bs-title="Ver Todas las Novedades">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaSoloNov"
            data-bs-toggle="tooltip" data-bs-title="Ver Solo Novedades Pendientes">
            <i class="bi bi-card-list me-2"></i>Vista de Solo Novedades
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirNovedades()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Novedades">
            <i class="bi bi-printer me-1"></i>Imprimir
        </button>
    </div>
</div>

<div id="novedades-formulario">
    <div class="card mb-4 shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="sub-title-dynamic mb-0"><i class="bi bi-pencil-square"></i>Nueva Novedad / Incidencia</h6>
        </div>
        <div class="card-body">
            <form id="formNovedad" class="row g-2">
                <div class="col-md-3">
                    <label class="form-label small fw-bold">Prioridad</label>
                    <select id="nov_prioridad" class="form-select form-select-sm" data-bs-toggle="tooltip" data-bs-title="Nivel de Urgencia">
                        <option value="Sin prioridad">Sin prioridad</option>
                        <option value="Urgente">🔴 Urgente</option>
                    </select>
                </div>
                <div class="col-md-9">
                    <label class="form-label small fw-bold">Departamentos Destino</label>
                    <div class="d-flex flex-wrap gap-2 p-2 border rounded bg-light" id="nov_depts_container"
                        style="max-height: 80px; overflow-y: auto;">
                        <!-- Inyectado por JS -->
                    </div>
                </div>
                <input type="hidden" id="nov_id">
                <div class="col-md-12">
                    <label class="form-label small fw-bold mb-1">Descripción de la Novedad</label>
                    <textarea id="nov_texto" class="form-control form-control-sm" rows="2"
                        placeholder="Ej: Fuga de agua en la 101, cliente solicita cambio..." required
                        data-bs-toggle="tooltip" data-bs-title="Detalle completo de la novedad"></textarea>
                </div>
                <div class="col-md-12">
                    <label class="form-label small fw-bold mb-1">Comentarios Adicionales / Seguimiento</label>
                    <textarea id="nov_comentario" class="form-control form-control-sm" rows="1"
                        placeholder="Notas de seguimiento o resolución..."
                        data-bs-toggle="tooltip" data-bs-title="Seguimiento / Resolución"></textarea>
                </div>
                <div class="col-12 d-flex justify-content-end align-items-center gap-2 mt-2">
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="limpiarNovedadesTerminadas()"
                        data-bs-toggle="tooltip" data-bs-title="Archivar Novedades Resueltas">
                        <i class="bi bi-trash me-1"></i>Limpiar Terminadas
                    </button>
                    <button type="submit" id="btnSubmitNovedad" class="btn btn-primary btn-sm px-4 fw-bold shadow-sm">
                        <i class="bi bi-save-fill me-2"></i>Registrar Novedad
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-header py-3 d-flex justify-content-between align-items-center">
        <h6 class="mb-0 fw-bold">Historial de Novedades Activas</h6>
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th style="width: 150px;">Fecha / Hora</th>
                    <th style="width: 120px;">Prioridad</th>
                    <th>Novedad / Departamentos</th>
                    <th style="width: 150px;">Estado</th>
                    <th style="width: 100px;" class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody id="tablaNovedadesCuerpo"></tbody>
        </table>
    </div>
</div>

<style>
    .nov-urgente {
        border-left: 4px solid #dc3545 !important;
        background-color: rgba(220, 53, 69, 0.02);
    }

    .status-badge {
        cursor: pointer;
        transition: transform 0.2s;
    }

    .status-badge:hover {
        transform: scale(1.05);
    }
</style>
            </div>
            <div class="tab-pane fade" id="estancia-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Estancia</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-estancia"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-estancia"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-bar-chart-line-fill"></i>Control de Estancia</h4>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoEstancia"
            data-bs-toggle="tooltip" data-bs-title="Ver Formulario y Tabla">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaGraficasEstancia"
            data-bs-toggle="tooltip" data-bs-title="Ver Gráficas de Ocupación">
            <i class="bi bi-graph-up me-2"></i>Vista de Gráficas
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirEstancia()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Listado Mensual">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<!-- VISTA DE TRABAJO -->
<div id="estancia-trabajo">
    <div class="card mb-4 shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="sub-title-dynamic mb-0"><i class="bi bi-plus-circle"></i>Registrar Ocupación Diaria</h6>
        </div>
        <div class="card-body">
            <form id="formEstancia" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label small fw-bold"><i class="bi bi-calendar-event me-1"></i>Fecha
                        Registro</label>
                    <div class="input-group">
                        <input type="date" id="estancia_fecha" class="form-control" required readonly
                            data-bs-toggle="tooltip" data-bs-title="Fecha del Registro">
                        <button class="btn btn-outline-secondary" type="button" id="btnToggleLockFecha"
                            title="Desbloquear fecha para editar anteriores" data-bs-toggle="tooltip">
                            <i class="bi bi-lock-fill" id="iconLockFecha"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Hab. Ocupadas</label>
                    <input type="number" id="estancia_ocupadas" class="form-control" min="0" max="190" required
                        data-bs-toggle="tooltip" data-bs-title="Total Habitaciones Ocupadas">
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Total Hotel</label>
                    <input type="text" id="estancia_total_ref" class="form-control bg-light" value="190" readonly>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100 fw-bold py-2" data-bs-toggle="tooltip" data-bs-title="Guardar Datos"><i class="bi bi-save-fill me-2"></i>Guardar Registro</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">Listado Diario del Mes</h6>
            <div class="d-flex gap-2">
                <select id="filtroMonthEstancia" class="form-select form-select-sm" style="width: 130px;"
                    onchange="mostrarEstancia()" data-bs-toggle="tooltip" data-bs-title="Filtrar Mes">
                    <option value="0">Enero</option>
                    <option value="1">Febrero</option>
                    <option value="2">Marzo</option>
                    <option value="3">Abril</option>
                    <option value="4">Mayo</option>
                    <option value="5">Junio</option>
                    <option value="6">Julio</option>
                    <option value="7">Agosto</option>
                    <option value="8">Septiembre</option>
                    <option value="9">Octubre</option>
                    <option value="10">Noviembre</option>
                    <option value="11">Diciembre</option>
                </select>
                <select id="filtroYearEstancia" class="form-select form-select-sm" style="width: 90px;"
                    onchange="mostrarEstancia()"></select>
                <button class="btn btn-sm btn-outline-success" onclick="exportarEstanciaExcel()"
                        data-bs-toggle="tooltip" data-bs-title="Descargar Excel (.xlsx)">
                    <i class="bi bi-file-earmark-spreadsheet me-1"></i>Exportar Excel
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
                <thead class="table-light">
                    <tr>
                        <th>Día</th>
                        <th>Ocupadas</th>
                        <th>Vacías/Bloq.</th>
                        <th>Libres</th>
                        <th>% Ocupación</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaEstanciaCuerpo"></tbody>
                <tfoot class="table-light fw-bold" id="tablaEstanciaPie"></tfoot>
            </table>
        </div>
    </div>
</div>

<!-- VISTA DE GRÁFICAS -->
<div id="estancia-graficas" class="d-none">
    <div class="row g-4">
        <div class="col-md-8">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header py-3">
                    <h6 class="mb-0 fw-bold">Evolución de Ocupación (%)</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px;"><canvas id="chartEstanciaEvolucion"></canvas></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-primary bg-gradient text-white h-100" id="estancia_anual_stats">
                <!-- Inyectado por JS -->
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="desayuno-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Desayunos Tempranos</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-desayuno"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-desayuno"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-egg-fried"></i>Desayunos Tempranos</h4>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoDesayuno"
            data-bs-toggle="tooltip" data-bs-title="Ver Formulario y Lista">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaRackDesayuno"
            data-bs-toggle="tooltip" data-bs-title="Ver Resumen por Habitaciones">
            <i class="bi bi-grid-3x3-gap me-2"></i>Vista de Rack
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirDesayunos()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Listado para Cocina">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<!-- VISTA DE TRABAJO -->
<div id="desayuno-trabajo">
    <div class="card mb-4 shadow-sm border-0 no-print">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold"><i class="bi bi-egg-fried me-2"></i>Registrar Desayuno Temprano</h6>
        </div>
        <div class="card-body">
            <form id="formNuevoDesayuno" class="row g-3 align-items-end">
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Habitación</label>
                    <input type="text" id="desayuno_hab" class="form-control" placeholder="Ej: 101" required
                        list="lista-habs-desayuno" data-bs-toggle="tooltip" data-bs-title="Número de Habitación">
                    <datalist id="lista-habs-desayuno"></datalist>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Pax (Personas)</label>
                    <input type="number" id="desayuno_pax" class="form-control" min="1" value="2" required
                        data-bs-toggle="tooltip" data-bs-title="Número de Personas">
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Hora</label>
                    <input type="time" id="desayuno_hora" class="form-control" required
                        data-bs-toggle="tooltip" data-bs-title="Hora de Recogida/Servicio">
                </div>
                <div class="col-md-4">
                    <label class="form-label small fw-bold">Observaciones</label>
                    <textarea id="desayuno_obs" class="form-control" rows="2"
                        placeholder="Ej: Celíacos, picnic para llevar..."
                        data-bs-toggle="tooltip" data-bs-title="Detalles Específicos"></textarea>
                </div>
                <div class="col-12 d-flex justify-content-end align-items-center gap-2 mt-2">
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="limpiarDesayunos()"
                        data-bs-toggle="tooltip" data-bs-title="Eliminar todos los registros">
                        <i class="bi bi-trash me-1"></i>Borrar Todo
                    </button>
                    <button type="submit" id="btnSubmitDesayuno" class="btn btn-primary btn-sm px-4 fw-bold shadow-sm"
                        data-bs-toggle="tooltip" data-bs-title="Guardar Pedido">
                        <i class="bi bi-save-fill me-2"></i>Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold">Pedidos para Mañana</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Habitación</th>
                        <th>Pax</th>
                        <th>Hora</th>
                        <th>Observaciones</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaDesayunoActivos"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- VISTA DE RACK -->
<div id="desayuno-rack" class="d-none">
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <h6 class="fw-bold text-muted mb-3 small">RESUMEN DE DESAYUNOS</h6>
            <div id="desayuno-stats" class="row g-2">
                <!-- Inyectado por JS -->
            </div>
        </div>
    </div>
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div id="rack-desayuno-habitaciones" class="d-flex flex-wrap gap-1 justify-content-start"></div>
        </div>
    </div>
</div>

<!-- Sección de Firmas para Impresión -->
<div class="d-none d-print-block mt-5">
    <div class="row g-5">
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Recepcionista:</small>
                <div class="fw-bold border-bottom border-dark pb-1" id="print-repc-nombre" style="min-height: 20px;">
                </div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;">
                <small class="fw-bold">Firma Recepcionista</small>
            </div>
        </div>
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Cocinero/a:</small>
                <div class="border-bottom border-dark pb-1" style="min-height: 20px;">&nbsp;</div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;">
                <small class="fw-bold">Firma Cocina</small>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="cena-fria-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Cenas Frías</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-cena"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-cena"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-moon-stars-fill"></i>Cenas Frías</h4>

<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajoCena"
            data-bs-toggle="tooltip" data-bs-title="Ver Formulario y Lista">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaRackCena"
            data-bs-toggle="tooltip" data-bs-title="Ver Resumen por Habitaciones">
            <i class="bi bi-grid-3x3-gap me-2"></i>Vista de Rack
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirCenasFrias()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Listado para Cocina">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<!-- VISTA DE TRABAJO -->
<div id="cena-fria-trabajo">
    <div class="card mb-4 shadow-sm border-0 no-print">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold"><i class="bi bi-moon-stars me-2"></i>Registrar Cena Fría</h6>
        </div>
        <div class="card-body">
            <form id="formNuevaCena" class="row g-3 align-items-end">
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Habitación</label>
                    <input type="text" id="cena_hab" class="form-control" placeholder="Ej: 101" required
                        list="lista-habs-cena" data-bs-toggle="tooltip" data-bs-title="Número de Habitación">
                    <datalist id="lista-habs-cena"></datalist>
                </div>
                <div class="col-md-2">
                    <label class="form-label small fw-bold">Pax</label>
                    <input type="number" id="cena_pax" class="form-control" min="1" value="2" required
                        data-bs-toggle="tooltip" data-bs-title="Número de Personas">
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold">Observaciones</label>
                    <textarea id="cena_obs" class="form-control" rows="2"
                        placeholder="Ej: Sin embutido, mucha fruta..."
                        data-bs-toggle="tooltip" data-bs-title="Detalles Específicos"></textarea>
                </div>
                <div class="col-12 d-flex justify-content-end align-items-center gap-2 mt-2">
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="limpiarCenasFrias()"
                        data-bs-toggle="tooltip" data-bs-title="Eliminar todos los registros">
                        <i class="bi bi-trash me-1"></i>Borrar Todo
                    </button>
                    <button type="submit" id="btnSubmitCena" class="btn btn-primary btn-sm px-4 fw-bold shadow-sm" data-bs-toggle="tooltip" data-bs-title="Guardar Pedido">
                        <i class="bi bi-save-fill me-2"></i>Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold">Cenas Pendientes</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Habitación</th>
                        <th>Pax</th>
                        <th>Observaciones</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaCenaActivos"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- VISTA DE RACK -->
<div id="cena-fria-rack" class="d-none">
    <div id="cena-stats" class="row g-2 mb-4"></div>
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div id="rack-cena-habitaciones" class="d-flex flex-wrap gap-1 justify-content-start"></div>
        </div>
    </div>
</div>

<!-- Sección de Firmas -->
<div class="d-none d-print-block mt-5">
    <div class="row g-5">
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Recepcionista:</small>
                <div class="fw-bold border-bottom border-dark pb-1" id="print-repc-nombre-cena-firma"
                    style="min-height: 20px;"></div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma
                    Recepcionista</small></div>
        </div>
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Cocinero/a:</small>
                <div class="border-bottom border-dark pb-1" style="min-height: 20px;">&nbsp;</div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma
                    Cocina</small></div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="atenciones-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Reporte de Atenciones</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-atenciones"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-atenciones"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-gift-fill"></i>Registro de Atenciones</h4>
<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnVistaTrabajo"
            data-bs-toggle="tooltip" data-bs-title="Ver Formulario y Lista">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary" id="btnVistaRack"
            data-bs-toggle="tooltip" data-bs-title="Ver Resumen por Habitaciones">
            <i class="bi bi-grid-3x3-gap me-2"></i>Vista de Rack
        </button>
    </div>

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirAtenciones()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Listado para Gobernanta/Room Service">
            <i class="bi bi-printer me-2"></i>Imprimir Listado
        </button>
    </div>
</div>

<div id="atenciones-trabajo">
    <div class="card mb-4 shadow-sm border-0 no-print">
        <div class="card-header py-3">
            <h6 class="sub-title-dynamic mb-0"><i class="bi bi-gift"></i>Añadir / Editar Atención</h6>
        </div>
        <div class="card-body">
            <form id="formNuevaAtencion" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label small fw-bold">Habitación</label>
                    <input type="text" id="atencion_hab" class="form-control" placeholder="Ej: 101" required
                        list="lista-habs-atenciones" data-bs-toggle="tooltip" data-bs-title="Número de Habitación">
                    <datalist id="lista-habs-atenciones"></datalist>
                </div>
                <div class="col-md-9">
                    <label class="form-label small fw-bold">Tipos de Atención</label>
                    <div class="d-flex flex-wrap gap-2 p-2 border rounded bg-light"
                        style="max-height: 120px; overflow-y: auto;">
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Fruta" id="at_fruta"><label class="form-check-label small" for="at_fruta"><i
                                    class="bi bi-apple me-1"></i>Fruta</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Fruta Especial" id="at_fruta_esp"><label class="form-check-label small"
                                for="at_fruta_esp"><i class="bi bi-basket2 me-1"></i>Fruta Esp.</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Cava" id="at_cava"><label class="form-check-label small" for="at_cava"><i
                                    class="bi bi-cup-straw me-1"></i>Cava</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Flores" id="at_flores"><label class="form-check-label small" for="at_flores"><i
                                    class="bi bi-flower1 me-1"></i>Flores</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Agua" id="at_agua"><label class="form-check-label small" for="at_agua"><i
                                    class="bi bi-droplet me-1"></i>Agua</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Mojo" id="at_mojo"><label class="form-check-label small" for="at_mojo"><i
                                    class="bi bi-bowl me-1"></i>Mojo</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Tetera" id="at_tetera"><label class="form-check-label small" for="at_tetera"><i
                                    class="bi bi-cup-hot me-1"></i>Tetera</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Carta" id="at_carta"><label class="form-check-label small" for="at_carta"><i
                                    class="bi bi-envelope me-1"></i>Carta</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="SPA" id="at_spa"><label class="form-check-label small" for="at_spa"><i
                                    class="bi bi-water me-1"></i>SPA</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Minibar Bienvenida" id="at_minibar"><label class="form-check-label small"
                                for="at_minibar"><i class="bi bi-snow me-1"></i>Minibar</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Regalo" id="at_regalo"><label class="form-check-label small" for="at_regalo"><i
                                    class="bi bi-gift me-1"></i>Regalo</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="1/2 Vino" id="at_vino"><label class="form-check-label small" for="at_vino"><i
                                    class="bi bi-glass-pink me-1"></i>1/2 Vino</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Tarta" id="at_tarta"><label class="form-check-label small" for="at_tarta"><i
                                    class="bi bi-cake2 me-1"></i>Tarta</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Tarjeta" id="at_tarjeta"><label class="form-check-label small"
                                for="at_tarjeta"><i class="bi bi-card-text me-1"></i>Tarjeta</label></div>
                        <div class="form-check me-2"><input class="form-check-input check-atencion" type="checkbox"
                                value="Regalo Niños" id="at_ninos"><label class="form-check-label small"
                                for="at_ninos"><i class="bi bi-robot me-1"></i>Regalo Niños</label></div>
                    </div>
                </div>
                <div class="col-md-9">
                    <label class="form-label small fw-bold">Comentario / Observaciones</label>
                    <textarea id="atencion_comentario" class="form-control" rows="2"
                        placeholder="Ej: Poner en la mesa, cliente alérgico..."
                        data-bs-toggle="tooltip" data-bs-title="Detalles Específicos"></textarea>
                </div>
                <div class="col-12 d-flex justify-content-end align-items-center gap-2 mt-2">
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="resetearAtenciones()"
                        data-bs-toggle="tooltip" data-bs-title="Eliminar todas las atenciones">
                        <i class="bi bi-trash me-1"></i>Borrar Todo
                    </button>
                    <button type="submit" id="btnSubmitAtenciones" class="btn btn-primary btn-sm px-4 fw-bold shadow-sm" data-bs-toggle="tooltip" data-bs-title="Guardar Atención">
                        <i class="bi bi-save-fill me-2"></i>Registrar Atención
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="card shadow-sm border-0">
        <div class="card-header py-3">
            <h6 class="mb-0 fw-bold">Atenciones Activas</h6>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 table-atenciones-print">
                <thead class="table-light">
                    <tr>
                        <th style="width: 15%;">Habitación</th>
                        <th style="width: 40%;">Atenciones</th>
                        <th style="width: 30%;">Comentario</th>
                        <th style="width: 20%;" class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaAtencionesActivas"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Sección de Firmas -->
<div class="d-none d-print-block mt-5">
    <div class="row g-5">
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Recepcionista:</small>
                <div class="fw-bold border-bottom border-dark pb-1" id="print-repc-nombre-atenciones"
                    style="min-height: 20px;"></div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma
                    Recepcionista</small></div>
        </div>
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Pisos/Gobernanta:</small>
                <div class="border-bottom border-dark pb-1" style="min-height: 20px;">&nbsp;</div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma
                    Pisos</small></div>
        </div>
    </div>
</div>

<div id="atenciones-rack" class="d-none">
    <div id="atenciones-stats" class="row g-2 mb-4"></div>
    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div id="rack-habitaciones" class="d-flex flex-wrap gap-1 justify-content-start"></div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="ayuda-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Guías Operativas</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-ayuda"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-ayuda"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-journal-check"></i>Guías Operativas</h4>

<div class="module-toolbar no-print d-flex justify-content-end">
    <div class="btn-print-wrapper">
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirGuia()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Guía Operativa">
            <i class="bi bi-printer me-2"></i>Imprimir Guía
        </button>
    </div>
</div>

<div id="ayuda-wrapper" class="container-fluid p-4">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3 border-bottom no-print">
            
            <div class="mb-3">
                 <h6 class="sub-title-dynamic mb-0"><i class="bi bi-journal-text"></i>Selección de Manual</h6>
            </div>

            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <select class="form-select form-select-sm fw-bold border-primary text-primary" id="select-guia-ayuda"
                        style="width: auto; min-width: 220px;" data-bs-toggle="tooltip" data-bs-title="Selecciona la Guía">
                        <option value="noche" selected>🌙 Guía Turno de Noche</option>
                        <option value="mañana">☕ Guía Turno de Mañana</option>
                        <option value="tarde">☀️ Guía Turno de Tarde</option>
                    </select>
                    <h5 class="mb-0 text-primary fw-bold d-none" id="titulo-guia"></h5>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="toggleEdicionGuia()"
                            data-bs-toggle="tooltip" data-bs-title="Modificar pasos de la guía">
                        <i class="bi bi-lock-fill me-1" id="icono-candado"></i>
                        <span id="texto-btn-edicion">Editar Guía</span>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="resetearChecksGuia()"
                            data-bs-toggle="tooltip" data-bs-title="Desmarcar todas las tareas">
                        <i class="bi bi-arrow-counterclockwise me-2"></i>Resetear Todo
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div id="lista-pasos-container" class="list-group list-group-flush">
                <!-- Los pasos se renderizan aquí -->
            </div>

            <!-- Área de agregar paso (Solo visible en edición) -->
            <div id="form-agregar-paso" class="p-3 bg-light border-top d-none no-print">
                <div class="d-flex gap-2 align-items-start">
                    <div id="nuevo-paso-texto" contenteditable="true" class="form-control bg-white"
                        onfocus="setFoco(this)"
                        onkeydown="if(event.key==='Enter'){event.preventDefault(); agregarPasoGuiaManual();}"
                        style="min-height: 38px;"></div>
                    <button onclick="agregarPasoGuiaManual()" class="btn btn-primary px-4"><i class="bi bi-plus-lg"></i>
                        Añadir</button>
                </div>
            </div>
        </div>
        <div class="card-footer bg-light text-muted small no-print">
            <i class="bi bi-info-circle me-1"></i>
            <span id="info-footer">Modo Lectura: Marca las casillas a medida que completes las tareas.</span>
        </div>
    </div>
</div>

<!-- Sección de Firmas (Solo impresión) -->
<div class="d-none d-print-block mt-5">
    <div class="row g-5">
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Nombre Recepcionista:</small>
                <div class="fw-bold border-bottom border-dark pb-1" id="print-repc-nombre-ayuda-footer"
                    style="min-height: 20px;"></div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma
                    Recepcionista</small></div>
        </div>
        <div class="col-6">
            <div class="mb-4">
                <small class="text-muted d-block mb-1">Vº Bº Jefe Recepción:</small>
                <div class="border-bottom border-dark pb-1" style="min-height: 20px;">&nbsp;</div>
            </div>
            <div class="text-center pt-3" style="border-top: 1px dashed #ccc;"><small class="fw-bold">Firma / Sello</small></div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="notas-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Tablón de Notas</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-notas"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-journal-bookmark-fill"></i>Tablón de Notas</h4>

<!-- 1. BARRA DE IMPRESIÓN (Toolbar estándar) -->
<div class="module-toolbar d-flex justify-content-end align-items-center p-2 mb-3 border-bottom no-print">
    <div class="btn-print-wrapper">
        <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Tablón">
            <i class="bi bi-printer me-2"></i>Imprimir Tablón
        </button>
    </div>
</div>

<!-- 2. PANEL DE GESTIÓN (Subtítulo dinámico + Controles) -->
<div class="card shadow-sm border-0 mb-4 bg-light no-print">
    <div class="card-body py-2 px-3 d-flex flex-wrap justify-content-between align-items-center gap-3">
        
        <!-- Izquierda: Subtítulo y Botones -->
        <div class="d-flex align-items-center gap-4">
            <h6 class="sub-title-dynamic mb-0"><i class="bi bi-gear-wide-connected"></i>Panel de Gestión</h6>
            
            <div class="vr h-100 mx-1 opacity-25"></div>

            <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary btn-sm fw-bold shadow-sm group-control" id="btn-lock-notas"
                    data-bs-toggle="tooltip" data-bs-title="Gestionar Permisos">
                    <i class="bi bi-lock-fill" id="icon-lock-notas"></i> 
                    <span id="text-lock-notas" class="ms-2">Bloqueado</span>
                </button>
                
                <button type="button" class="btn btn-success btn-sm fw-bold shadow-sm d-none animate__animated animate__fadeIn group-control" id="btn-nueva-nota" onclick="abrirModalNota()"
                    data-bs-toggle="tooltip" data-bs-title="Añadir Nota">
                    <i class="bi bi-plus-lg me-2"></i>Nueva Nota
                </button>
            </div>
        </div>

        <!-- Derecha: Buscador -->
        <div class="input-group input-group-sm shadow-sm" style="width: 250px;">
             <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
             <input type="text" id="searchNotas" class="form-control border-start-0 ps-0" placeholder="Buscar nota..." >
        </div>
    </div>
</div>

<div class="row g-4 px-3 pb-4" id="grid-notas">
    <!-- Aquí se renderizan los post-its -->
</div>

<!-- Modal para Crear/Editar Nota -->
<div class="modal fade" id="modalNota" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold" id="modalNotaTitle">Nueva Nota</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formNota">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Color del Post-it</label>
                        <div class="d-flex gap-2 justify-content-center p-2 bg-light rounded">
                            <input type="radio" class="btn-check" name="colorNota" id="color-yellow" value="note-yellow"
                                checked>
                            <label class="btn rounded-circle border-2 d-flex align-items-center justify-content-center"
                                for="color-yellow"
                                style="width: 40px; height: 40px; background-color: #fff740; border-color: transparent;"><i
                                    class="bi bi-check-lg d-none text-dark"></i></label>

                            <input type="radio" class="btn-check" name="colorNota" id="color-pink" value="note-pink">
                            <label class="btn rounded-circle border-2 d-flex align-items-center justify-content-center"
                                for="color-pink"
                                style="width: 40px; height: 40px; background-color: #ff7eb9; border-color: transparent;"><i
                                    class="bi bi-check-lg d-none text-dark"></i></label>

                            <input type="radio" class="btn-check" name="colorNota" id="color-blue" value="note-blue">
                            <label class="btn rounded-circle border-2 d-flex align-items-center justify-content-center"
                                for="color-blue"
                                style="width: 40px; height: 40px; background-color: #7afcff; border-color: transparent;"><i
                                    class="bi bi-check-lg d-none text-dark"></i></label>

                            <input type="radio" class="btn-check" name="colorNota" id="color-green" value="note-green">
                            <label class="btn rounded-circle border-2 d-flex align-items-center justify-content-center"
                                for="color-green"
                                style="width: 40px; height: 40px; background-color: #c7f464; border-color: transparent;"><i
                                    class="bi bi-check-lg d-none text-dark"></i></label>

                            <input type="radio" class="btn-check" name="colorNota" id="color-orange"
                                value="note-orange">
                            <label class="btn rounded-circle border-2 d-flex align-items-center justify-content-center"
                                for="color-orange"
                                style="width: 40px; height: 40px; background-color: #ffb347; border-color: transparent;"><i
                                    class="bi bi-check-lg d-none text-dark"></i></label>
                        </div>
                        <style>
                            .btn-check:checked+label {
                                border-color: #666 !important;
                                transform: scale(1.1);
                            }

                            .btn-check:checked+label i {
                                display: block !important;
                            }
                        </style>
                    </div>
                    <div class="mb-3">
                        <label for="notaTitulo" class="form-label small fw-bold text-muted">Título</label>
                        <input type="text" class="form-control fw-bold" id="notaTitulo"
                            placeholder="Ej: Contraseñas Wifi...">
                    </div>
                    <div class="mb-3">
                        <label for="notaContenido" class="form-label small fw-bold text-muted">Contenido</label>
                        <textarea class="form-control" id="notaContenido" rows="5"
                            placeholder="Ej: La contraseña es 1234..."></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary fw-bold">Guardar Nota</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="gallery-content" role="tabpanel">
                <h4 class="module-title-discrete"><i class="bi bi-images"></i>Galería de Información</h4>
                
                <div class="module-toolbar mb-4 no-print">
                    <!-- Row 1: Search and Filters -->
                    <div class="row g-2 mb-2 align-items-center">
                        <div class="col-md-4">
                            <div class="input-group input-group-sm shadow-sm">
                                <span class="input-group-text bg-white border-end-0 text-muted px-3"><i class="bi bi-search"></i></span>
                                <input type="text" id="gallerySearch" class="form-control border-start-0 py-2" placeholder="Buscar en galer&iacute;as...">
                            </div>
                        </div>
                        <div class="col-md-auto d-flex gap-2 flex-grow-1">
                            <select id="galleryTypeFilter" class="form-select form-select-sm shadow-sm border-0 bg-white" style="width: auto;">
                                <option value="all">Filtro: Todo</option>
                                <option value="image">Im&aacute;genes</option>
                                <option value="pdf">PDFs</option>
                            </select>

                            <select id="galleryFolderFilter" class="form-select form-select-sm shadow-sm border-0 bg-white" style="max-width: 250px;">
                                <option value="all">Todas las Carpetas</option>
                            </select>

                            <select id="gallerySort" class="form-select form-select-sm shadow-sm border-0 bg-white" style="width: auto;">
                                <option value="mtime_desc">Recientes primero</option>
                                <option value="mtime_asc">Antiguos primero</option>
                                <option value="name_asc">Nombre (A-Z)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Row 2: Actions and Tools -->
                    <div class="row g-2 align-items-center border-top pt-2">
                        <div class="col-md-auto d-flex gap-2">
                            <!-- Favorite Filter -->
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="checkbox" class="btn-check" id="galleryFavoriteFilter" autocomplete="off">
                                <label class="btn btn-outline-warning shadow-sm border-0 bg-white" for="galleryFavoriteFilter">
                                    <i class="bi bi-star-fill me-1"></i> Favoritos
                                </label>
                            </div>

                            <!-- Selection Mode -->
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="checkbox" class="btn-check" id="gallerySelectionMode" autocomplete="off">
                                <label class="btn btn-outline-primary shadow-sm border-0 bg-white" for="gallerySelectionMode">
                                    <i class="bi bi-check2-square me-1"></i> Selecci&oacute;n
                                </label>
                            </div>
                        </div>

                        <div class="col-md d-flex align-items-center justify-content-between">
                            <!-- Bulk Actions (Hidden by default) -->
                            <div id="galleryBulkActions" class="d-none align-items-center gap-2">
                                <span class="small fw-bold text-primary mx-2"><i class="bi bi-layers me-1"></i><span id="gallerySelectedCount">0</span> seleccionados</span>
                                <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="Gallery.copySelected()">
                                    <i class="bi bi-clipboard-plus me-1"></i>Copiar lote
                                </button>
                                <button class="btn btn-outline-info btn-sm fw-bold shadow-sm bg-white text-info" onclick="Gallery.printSelected()">
                                    <i class="bi bi-printer me-1"></i>Imprimir lote
                                </button>
                                <button class="btn btn-outline-secondary btn-sm border-0" onclick="Gallery.clearSelection()">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>

                            <!-- Refresh -->
                            <button class="btn btn-outline-primary btn-sm fw-bold shadow-sm border-0 bg-white ms-auto" onclick="Gallery.loadImages(true)" title="Sincronizar carpetas">
                                <i class="bi bi-arrow-clockwise me-1"></i>Sincronizar
                            </button>
                        </div>
                    </div>
                </div>

                <style>
                    .gallery-card { transition: transform 0.2s, box-shadow 0.2s; position: relative; }
                    .gallery-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }
                    .favorite-btn {
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        z-index: 10;
                        background: rgba(255,255,255,0.8);
                        border-radius: 50%;
                        width: 32px;
                        height: 32px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        transition: all 0.2s;
                        border: 1px solid #eee;
                    }
                    .favorite-btn:hover { transform: scale(1.1); background: #fff; }
                    .favorite-btn.active { color: #ffc107; background: #fff; border-color: #ffc107; }
                    .favorite-btn i { font-size: 1.1rem; }
                    
                    /* Grid improvements */
                    .gallery-item-col { transition: all 0.3s ease; }
                    .card-img-wrapper canvas { width: 100%; height: 100%; object-fit: cover; }

                    /* Fullscreen mode */
                    #gallery-viewer-wrapper.fullscreen-active {
                        position: fixed;
                        top: 0; left: 0; width: 100vw; height: 100vh;
                        z-index: 2000;
                        background: black;
                    }
                    #gallery-viewer-wrapper.fullscreen-active .viewer-controls-overlay,
                    #gallery-viewer-wrapper.fullscreen-active .viewer-nav-btn {
                        opacity: 0;
                        transition: opacity 0.3s;
                    }
                    #gallery-viewer-wrapper.fullscreen-active:hover .viewer-controls-overlay,
                    #gallery-viewer-wrapper.fullscreen-active:hover .viewer-nav-btn {
                        opacity: 1;
                    }

                    /* Selection Styles */
                    .selection-checkbox {
                        position: absolute;
                        top: 10px;
                        left: 10px;
                        z-index: 10;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        accent-color: #0d6efd;
                    }
                    .gallery-card.selected { outline: 3px solid #0d6efd; box-shadow: 0 0 15px rgba(13,110,253,0.3) !important; }
                    .gallery-card.selection-active { cursor: pointer; }
                </style>

                <div class="content-panel" style="min-height: 400px;">
                    <div class="row g-3" id="gallery-grid">
                        <!-- JS Render -->
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" id="precios-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Lista de Precios</h2>
        <p>Hotel Garoé • Recepción</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-precios"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-precios"></span></div>
        <div class="text-muted" style="font-size: 7pt; margin-top: 5px;">Documento Interno de Uso Operativo</div>
    </div>
</div>

<h4 class="module-title-discrete"><i class="bi bi-tags-fill"></i>Lista de Precios</h4>
<div class="module-toolbar no-print d-flex justify-content-end">

    <div class="btn-print-wrapper">
        <!-- Selector eliminado: Se usa usuario global -->
        <button class="btn btn-primary btn-sm fw-bold" onclick="imprimirPrecios()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Listado de Precios">
            <i class="bi bi-printer me-2"></i>Imprimir Lista
        </button>
    </div>
</div>

<div class="container-fluid p-3">
    <div class="card shadow-sm border-0">
        <!-- Controles de Filtro y Edición -->
        <div class="card-header bg-white py-3 border-bottom no-print">
            <div class="d-flex justify-content-between align-items-center gap-3">
                <h6 class="sub-title-dynamic mb-0"><i class="bi bi-tags-fill"></i>Lista de Precios</h6>
                <div class="d-flex align-items-center gap-2">
                    <div class="input-group input-group-sm" style="max-width: 300px;">
                        <span class="input-group-text bg-light border-end-0"><i
                                class="bi bi-search text-muted" style="animation: none !important; transform: none !important;"></i></span>
                        <input type="text" id="search-precios-modulo" class="form-control border-start-0 bg-light"
                            placeholder="Buscar artículo..." data-bs-toggle="tooltip" data-bs-title="Filtrar por nombre...">
                    </div>

                    <button class="btn btn-outline-primary btn-sm text-nowrap" onclick="toggleEdicionPrecios()"
                            data-bs-toggle="tooltip" data-bs-title="Añadir o Borrar Artículos">
                        <i class="bi bi-lock-fill me-1" id="icon-lock-precios"></i>
                        <span id="btn-text-precios">Editar Lista</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Formulario de añadir (Solo visible en edición) -->
        <div id="form-add-precio-container" class="card-body bg-light border-bottom p-3 d-none no-print">
            <form onsubmit="agregarPrecio(event)" class="row g-2 align-items-center">
                <div class="col-auto"><input type="text" id="new-precio-icon" class="form-control text-center"
                        placeholder="Icono" style="width: 60px;" value="📦"
                        onclick="abrirSelectorIconos('new-precio-icon')" readonly role="button"
                        data-bs-toggle="tooltip" data-bs-title="Elige un icono"></div>
                <div class="col"><input type="text" id="new-precio-nombre" class="form-control"
                        placeholder="Ej: Coca Cola" required></div>
                <div class="col"><input type="text" id="new-precio-comentario" class="form-control"
                        placeholder="Comentario / Detalle"></div>
                <div class="col-auto">
                    <div class="input-group"><input type="number" id="new-precio-valor" class="form-control"
                            placeholder="0.00" step="0.01" style="width: 100px;" required><span
                            class="input-group-text">€</span></div>
                </div>
                <div class="col-auto"><button type="submit" class="btn btn-primary"><i
                            class="bi bi-plus-lg"></i></button></div>
            </form>
        </div>

        <div class="card-body p-0" style="max-height: calc(100vh - 220px); overflow-y: auto;">
            <!-- Vista de Pantalla (Cards) -->
            <div id="lista-precios-container" class="list-group list-group-flush no-print"></div>
            
            <!-- Vista de Impresión (Tabla limpia) -->
            <div class="d-none d-print-block p-2">
                <table class="table table-bordered align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 60px;"></th>
                            <th>Producto / Artículo</th>
                            <th>Descripción / Comentario</th>
                            <th class="text-end" style="width: 100px;">Precio</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-precios-print">
                        <!-- Se llena vía JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Selección de Icono -->
<div class="modal fade" id="modalIconos" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Seleccionar Icono</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs mb-3" id="iconTabs" role="tablist">
                    <li class="nav-item" role="presentation"><button class="nav-link active" id="emojis-tab"
                            data-bs-toggle="tab" data-bs-target="#emojis-panel" type="button"><i
                                class="bi bi-emoji-smile me-2"></i>Iconos</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="images-tab"
                            data-bs-toggle="tab" data-bs-target="#images-panel" type="button"><i
                                class="bi bi-image me-2"></i>Mi PC</button></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="emojis-panel" role="tabpanel">
                        <div class="input-group input-group-sm mb-2">
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                            <input type="text" class="form-control" placeholder="Filtrar iconos..."
                                onkeyup="filtrarEmojis(this.value)">
                        </div>
                        <div class="d-flex flex-wrap gap-2 justify-content-center" id="emoji-grid"
                            style="max-height: 300px; overflow-y: auto;"></div>
                    </div>
                    <div class="tab-pane fade" id="images-panel" role="tabpanel">
                        <div class="text-center p-4 border rounded bg-light">
                            <label for="inputImagenPC" class="btn btn-primary mb-3">
                                <i class="bi bi-upload me-2"></i>Seleccionar imagen del PC
                            </label>
                            <input type="file" id="inputImagenPC" class="d-none" accept="image/*"
                                onchange="procesarImagenSubida(this)">
                            <p class="small text-muted mb-0">La imagen se guardará y redimensionará automáticamente.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="impresion-content" role="tabpanel">
                <h4 class="module-title-discrete no-print"><i class="bi bi-printer-fill"></i> Módulo de Impresión Dinámica <span class="badge bg-primary" style="font-size: 0.5rem;">v1.40 - ISOLATED WINDOW</span></h4>

                <div class="module-toolbar no-print mb-3">
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-primary active" id="btnImpresionTrabajo">
                            <i class="bi bi-pencil-square me-2"></i>Preparar Datos
                        </button>
                        <button class="btn btn-outline-primary" id="btnImpresionVista">
                            <i class="bi bi-eye me-2"></i>Vista Previa Tarjetero
                        </button>
                    </div>

                    <div class="calibration-controls d-flex gap-2 ms-3 align-items-center">
                        <label class="small fw-bold text-muted">Ajuste (mm):</label>
                        <div class="input-group input-group-sm" style="width: 100px;">
                            <span class="input-group-text">X</span>
                            <input type="number" id="nudgeX" class="form-control" value="0" step="0.5">
                        </div>
                        <div class="input-group input-group-sm" style="width: 100px;">
                            <span class="input-group-text">Y</span>
                            <input type="number" id="nudgeY" class="form-control" value="0" step="0.5">
                        </div>
                        <button class="btn btn-outline-secondary btn-sm ms-1" id="btnToggleGuide">
                            <i class="bi bi-eye me-1"></i>Guía Visual
                        </button>
                    </div>

                    <div class="btn-print-wrapper ms-auto">
                        <button class="btn btn-primary fw-bold shadow-sm" onclick="ejecutarImpresionIframe()">
                            <i class="bi bi-printer me-2"></i>Imprimir Todo
                        </button>
                    </div>
                </div>

                <div id="impresion-v120-root">
                    <!-- Dinámicamente cargado por Impresion.js -->
                    <div class="p-5 text-center text-muted">
                        <div class="spinner-border spinner-border-sm me-2"></div>
                        Cargando motor de precisión...
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="system-alarms-content" role="tabpanel">
<h4 class="module-title-discrete"><i class="bi bi-broadcast"></i>Alarmas del Sistema</h4>

<div class="module-toolbar no-print d-flex justify-content-between align-items-center">
    <!-- View Toggles (Standardized Placeholder) -->
    <div class="btn-group shadow-sm" role="group">
        <button type="button" class="btn btn-outline-primary active fw-bold" id="btnVistaTrabajoAlarms"
            data-bs-toggle="tooltip" data-bs-title="Configuración">
            <i class="bi bi-pencil-square me-2"></i>Vista de Trabajo
        </button>
        <button type="button" class="btn btn-outline-primary fw-bold" id="btnVistaListaAlarms"
            data-bs-toggle="tooltip" data-bs-title="Histórico">
            <i class="bi bi-list-ul me-2"></i>Vista de Lista
        </button>
    </div>

    <div class="btn-print-wrapper">
        <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Alertas">
            <i class="bi bi-printer me-2"></i>Imprimir
        </button>
    </div>
</div>

<div class="row g-4">
    <!-- Formulario de Creación -->
    <div class="col-md-5" id="formSystemAlarm-col">
        <div class="content-panel h-100">
             <h6 class="sub-title-dynamic mb-3"><i class="bi bi-gear-wide"></i>Configurar Alerta</h6>
             <form id="formSystemAlarm">
                <input type="hidden" id="sys_alarm_id">
                
                <div class="mb-3">
                    <label class="form-label small fw-bold">Mensaje / Tarea</label>
                    <textarea id="sys_alarm_msg" class="form-control" rows="2" placeholder="Ej: Realizar cierre de caja..." required></textarea>
                </div>

                <div class="row">
                    <div class="col-6 mb-3">
                        <label class="form-label small fw-bold">Hora</label>
                        <input type="time" id="sys_alarm_hora" class="form-control text-center fw-bold" required>
                    </div>
                    <div class="col-6 mb-3">
                        <label class="form-label small fw-bold">Periodicidad</label>
                        <select id="sys_alarm_type" class="form-select" onchange="togglePeriodicidadInputs()">
                            <option value="daily">Diaria</option>
                            <option value="weekly">Semanal</option>
                            <option value="date">Una Fecha</option>
                        </select>
                    </div>
                </div>

                <!-- Input Condicional: Fecha -->
                <div class="mb-3 d-none" id="group-date">
                    <label class="form-label small fw-bold">Fecha Específica</label>
                    <input type="date" id="sys_alarm_date" class="form-control">
                </div>

                <!-- Input Condicional: Días Semana -->
                <div class="mb-3 d-none" id="group-days">
                    <label class="form-label small fw-bold mb-1">Días de la Semana</label>
                    <div class="d-flex justify-content-between bg-light p-2 rounded border">
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-1" value="1" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-1">L</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-2" value="2" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-2">M</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-3" value="3" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-3">X</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-4" value="4" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-4">J</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-5" value="5" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-5">V</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-6" value="6" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-6">S</label>
                        </div>
                        <div class="form-check form-check-inline p-0 m-0">
                            <input type="checkbox" class="btn-check" id="day-0" value="0" autocomplete="off">
                            <label class="btn btn-outline-primary btn-sm p-1 px-2" for="day-0">D</label>
                        </div>
                    </div>
                </div>

                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="sys_alarm_active" checked>
                    <label class="form-check-label" for="sys_alarm_active">Alarma Activa</label>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save me-2"></i>Guardar Alarma
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="resetFormSystemAlarm()">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lista de Alarmas -->
    <div class="col-md-7" id="systemAlarms-list-col">
        <div class="content-panel h-100">
            <h5 class="fw-bold mb-3">Alertas Programadas</h5>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 80px;">Hora</th>
                            <th>Mensaje</th>
                            <th>Frecuencia</th>
                            <th class="text-center" style="width: 50px;">Activa</th>
                            <th class="text-end" style="width: 100px;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tableSystemAlarmsBody">
                        <!-- JS Injection -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="rack-content" role="tabpanel">
<h4 class="module-title-discrete px-3"><i class="bi bi-grid-3x3-gap"></i>Rack de Habitaciones</h4>

<!-- Module Toolbar (Print) -->
<div class="module-toolbar d-flex justify-content-end align-items-center p-2 mb-3 border-bottom d-print-none">
    <div class="btn-print-wrapper gap-2">
        <button class="btn btn-primary btn-sm fw-bold" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Rack">
            <i class="bi bi-printer me-2"></i>Imprimir Rack
        </button>
    </div>
</div>

<div class="row h-100 g-0">
    <!-- Sidebar Filters -->
    <div class="col-md-3 col-lg-2 bg-light border-end p-3 overflow-auto d-print-none" style="height: calc(100vh - 120px);">
        
        <!-- Search Input -->
        <div class="mb-4">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-search"></i>Buscar</h6>
            <input type="search" id="room-search-input" class="form-control" placeholder="Buscar habitación..." autocomplete="off">
        </div>

        <h6 class="sub-title-dynamic mb-3 border-top pt-3"><i class="bi bi-funnel-fill"></i>Filtros</h6>
        
        <div class="d-grid gap-2 mb-4">
            <button class="btn btn-sm btn-outline-secondary" id="btn-reset-filters">
                <i class="bi bi-arrow-counterclockwise me-1"></i>Limpiar Filtros
            </button>
        </div>

        <!-- Tipos -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Tipo de Habitación</h6>
            <div id="filter-tipos-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Estados -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Estado</h6>
            <div id="filter-estados-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Vistas -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Vistas</h6>
            <div id="filter-vistas-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Extras -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Características</h6>
            <div id="filter-extras-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <div class="alert alert-info small mt-4 p-2">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando <strong id="rack-count-display">0</strong> habitaciones
        </div>
    </div>

    <!-- Main Rack Grid -->
    <div class="col-md-9 col-lg-10 p-0 bg-white overflow-auto" style="height: calc(100vh - 120px);">
        <!-- Print Header (Hidden on screen) -->
        <div class="report-header-print d-none d-print-block p-4 mb-2">
            <div class="d-flex justify-content-between align-items-end border-bottom pb-2">
                <div>
                    <h2 class="m-0 text-primary">RACK DE HABITACIONES</h2>
                    <p class="m-0 text-muted">Hotel Garoé - Estado Actual</p>
                </div>
                <div class="text-end small">
                    <div><strong>Fecha:</strong> <span id="print-date-rack"></span></div>
                </div>
            </div>
        </div>
        
        <div class="px-4 pt-3 pb-0 no-print">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-grid-3x3-gap"></i>Estado de Habitaciones</h6>
        </div>

        <div class="p-4 pt-0" id="rack-grid-container">
            <!-- Grid injected by JS -->
        </div>
    </div>
</div>

<!-- Room Details Modal -->
<div class="modal fade" id="roomDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-door-open me-2"></i>Habitación <span id="modal-room-number"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="room-details-form">
                    <fieldset id="room-details-fieldset" disabled>
                    <!-- Read-only Info -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Tipo de habitación">Tipo</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-type" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Vista principal">Vista</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-view" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                    </div>

                    <!-- Editable Status -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase" data-bs-toggle="tooltip" title="Estado actual de limpieza/ocupación">Estado</label>
                        <select class="form-select" id="modal-room-status" data-bs-toggle="tooltip" title="Selecciona el estado de la habitación">
                            <option value="DISPONIBLE" class="text-success fw-bold">Disponible</option>
                            <option value="BLOQUEADA" class="text-danger fw-bold">Bloqueada / Fuera de servicio</option>
                        </select>
                    </div>

                    <!-- Editable Comments -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase">Observaciones</label>
                        <textarea class="form-control" id="modal-room-comments" rows="3" placeholder="Añadir notas sobre la habitación..." data-bs-toggle="tooltip" title="Escribe aquí observaciones internas sobre la habitación"></textarea>
                    </div>

                    <!-- Toggle Features (Manual Overrides) -->
                     <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase mb-2" data-bs-toggle="tooltip" title="Modificar características manualmente">Características Extra (Override)</label>
                        <div class="d-flex flex-wrap gap-2">
                             <input type="checkbox" class="btn-check" id="check-sofa" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofa" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá"><i class="bi bi-journal-bookmark-fill me-1"></i>Sofá</label>

                             <input type="checkbox" class="btn-check" id="check-sofaCama" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofaCama" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá Cama"><i class="bi bi-archive-fill me-1"></i>Sofá Cama</label>

                             <input type="checkbox" class="btn-check" id="check-cheslong" autocomplete="off">
                             <label class="btn btn-outline-primary btn-sm" for="check-cheslong" data-bs-toggle="tooltip" data-bs-title="Habitación con Cheslong"><i class="bi bi-layout-sidebar me-1"></i>Cheslong</label>

                             <input type="checkbox" class="btn-check" id="check-ruidosa" autocomplete="off">
                             <label class="btn btn-outline-secondary btn-sm" for="check-ruidosa" data-bs-toggle="tooltip" data-bs-title="Habitación Ruidosa"><i class="bi bi-speaker-fill me-1"></i>Ruidosa</label>

                             <input type="checkbox" class="btn-check" id="check-tranquila" autocomplete="off">
                             <label class="btn btn-outline-success btn-sm" for="check-tranquila" data-bs-toggle="tooltip" data-bs-title="Habitación Tranquila"><i class="bi bi-soundwave me-1"></i>Tranquila</label>
                        </div>
                        <div class="form-text small mt-1">
                            <i class="bi bi-info-circle me-1"></i>Estas casillas permiten sobrescribir manualmente si una habitación tiene un extra que no está en la base de datos.
                        </div>
                    </div>
                    </fieldset> <!-- Closed Fieldset here to prevent disabling security inputs -->
                </form>

                <!-- Security Access Section -->
                <form onsubmit="return false;">
                    <div id="security-check-container" class="mt-4 border-top pt-3">
                        <label class="form-label small fw-bold text-danger"><i class="bi bi-shield-lock-fill me-1"></i>Seguridad Requerida</label>
                        <div class="input-group input-group-sm mb-2">
                            <input type="password" class="form-control" id="security-pin-input" placeholder="Introducir código para editar" autocomplete="off" data-bs-toggle="tooltip" title="Introduce el código de supervisor">
                            <button class="btn btn-outline-danger" type="button" id="btn-unlock-details" data-bs-toggle="tooltip" title="Desbloquear edición de formulario">
                                <i class="bi bi-unlock-fill me-1"></i>Desbloquear
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn-save-room-details" disabled onclick="window.saveRoomDetails()" data-bs-toggle="tooltip" title="Guardar cambios permanentemente">
                    <i class="bi bi-save me-1"></i>Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="transfers-content" role="tabpanel">
                <!-- Loaded via CompLoader from assets/templates/transfers.html -->
                <div class="text-center p-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2 text-muted">Cargando Traslados...</p>
                </div>
            </div>
            </div>
            <div class="tab-pane fade" id="rack-content" role="tabpanel">
<h4 class="module-title-discrete px-3"><i class="bi bi-grid-3x3-gap"></i>Rack de Habitaciones</h4>

<!-- Module Toolbar (Print) -->
<div class="module-toolbar d-flex justify-content-end align-items-center p-2 mb-3 border-bottom d-print-none">
    <div class="btn-print-wrapper gap-2">
        <button class="btn btn-primary btn-sm fw-bold" onclick="window.print()"
            data-bs-toggle="tooltip" data-bs-title="Imprimir Rack">
            <i class="bi bi-printer me-2"></i>Imprimir Rack
        </button>
    </div>
</div>

<div class="row h-100 g-0">
    <!-- Sidebar Filters -->
    <div class="col-md-3 col-lg-2 bg-light border-end p-3 overflow-auto d-print-none" style="height: calc(100vh - 120px);">
        
        <!-- Search Input -->
        <div class="mb-4">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-search"></i>Buscar</h6>
            <input type="search" id="room-search-input" class="form-control" placeholder="Buscar habitación..." autocomplete="off">
        </div>

        <h6 class="sub-title-dynamic mb-3 border-top pt-3"><i class="bi bi-funnel-fill"></i>Filtros</h6>
        
        <div class="d-grid gap-2 mb-4">
            <button class="btn btn-sm btn-outline-secondary" id="btn-reset-filters">
                <i class="bi bi-arrow-counterclockwise me-1"></i>Limpiar Filtros
            </button>
        </div>

        <!-- Tipos -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Tipo de Habitación</h6>
            <div id="filter-tipos-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Estados -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Estado</h6>
            <div id="filter-estados-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Vistas -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Vistas</h6>
            <div id="filter-vistas-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <!-- Extras -->
        <div class="mb-4">
            <h6 class="fw-bold text-primary small text-uppercase">Características</h6>
            <div id="filter-extras-container" class="d-flex flex-column gap-2">
                <!-- Checkboxes injected by JS -->
            </div>
        </div>

        <div class="alert alert-info small mt-4 p-2">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando <strong id="rack-count-display">0</strong> habitaciones
        </div>
    </div>

    <!-- Main Rack Grid -->
    <div class="col-md-9 col-lg-10 p-0 bg-white overflow-auto" style="height: calc(100vh - 120px);">
        <!-- Print Header (Hidden on screen) -->
        <div class="report-header-print d-none d-print-block p-4 mb-2">
            <div class="d-flex justify-content-between align-items-end border-bottom pb-2">
                <div>
                    <h2 class="m-0 text-primary">RACK DE HABITACIONES</h2>
                    <p class="m-0 text-muted">Hotel Garoé - Estado Actual</p>
                </div>
                <div class="text-end small">
                    <div><strong>Fecha:</strong> <span id="print-date-rack"></span></div>
                </div>
            </div>
        </div>
        
        <div class="px-4 pt-3 pb-0 no-print">
            <h6 class="sub-title-dynamic mb-3"><i class="bi bi-grid-3x3-gap"></i>Estado de Habitaciones</h6>
        </div>

        <div class="p-4 pt-0" id="rack-grid-container">
            <!-- Grid injected by JS -->
        </div>
    </div>
</div>

<!-- Room Details Modal -->
<div class="modal fade" id="roomDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-door-open me-2"></i>Habitación <span id="modal-room-number"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="room-details-form">
                    <fieldset id="room-details-fieldset" disabled>
                    <!-- Read-only Info -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Tipo de habitación">Tipo</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-type" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                        <div class="col-6">
                            <label class="form-label text-muted small text-uppercase" data-bs-toggle="tooltip" title="Vista principal">Vista</label>
                            <input type="text" class="form-control form-control-sm" id="modal-room-view" readonly disabled data-bs-toggle="tooltip" title="Este campo no se puede editar">
                        </div>
                    </div>

                    <!-- Editable Status -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase" data-bs-toggle="tooltip" title="Estado actual de limpieza/ocupación">Estado</label>
                        <select class="form-select" id="modal-room-status" data-bs-toggle="tooltip" title="Selecciona el estado de la habitación">
                            <option value="DISPONIBLE" class="text-success fw-bold">Disponible</option>
                            <option value="BLOQUEADA" class="text-danger fw-bold">Bloqueada / Fuera de servicio</option>
                        </select>
                    </div>

                    <!-- Editable Comments -->
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase">Observaciones</label>
                        <textarea class="form-control" id="modal-room-comments" rows="3" placeholder="Añadir notas sobre la habitación..." data-bs-toggle="tooltip" title="Escribe aquí observaciones internas sobre la habitación"></textarea>
                    </div>

                    <!-- Toggle Features (Manual Overrides) -->
                     <div class="mb-3">
                        <label class="form-label fw-bold small text-uppercase mb-2" data-bs-toggle="tooltip" title="Modificar características manualmente">Características Extra (Override)</label>
                        <div class="d-flex flex-wrap gap-2">
                             <input type="checkbox" class="btn-check" id="check-sofa" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofa" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá"><i class="bi bi-journal-bookmark-fill me-1"></i>Sofá</label>

                             <input type="checkbox" class="btn-check" id="check-sofaCama" autocomplete="off">
                             <label class="btn btn-outline-warning btn-sm" for="check-sofaCama" data-bs-toggle="tooltip" data-bs-title="Habitación con Sofá Cama"><i class="bi bi-archive-fill me-1"></i>Sofá Cama</label>

                             <input type="checkbox" class="btn-check" id="check-cheslong" autocomplete="off">
                             <label class="btn btn-outline-primary btn-sm" for="check-cheslong" data-bs-toggle="tooltip" data-bs-title="Habitación con Cheslong"><i class="bi bi-layout-sidebar me-1"></i>Cheslong</label>

                             <input type="checkbox" class="btn-check" id="check-ruidosa" autocomplete="off">
                             <label class="btn btn-outline-secondary btn-sm" for="check-ruidosa" data-bs-toggle="tooltip" data-bs-title="Habitación Ruidosa"><i class="bi bi-speaker-fill me-1"></i>Ruidosa</label>

                             <input type="checkbox" class="btn-check" id="check-tranquila" autocomplete="off">
                             <label class="btn btn-outline-success btn-sm" for="check-tranquila" data-bs-toggle="tooltip" data-bs-title="Habitación Tranquila"><i class="bi bi-soundwave me-1"></i>Tranquila</label>
                        </div>
                        <div class="form-text small mt-1">
                            <i class="bi bi-info-circle me-1"></i>Estas casillas permiten sobrescribir manualmente si una habitación tiene un extra que no está en la base de datos.
                        </div>
                    </div>
                    </fieldset> <!-- Closed Fieldset here to prevent disabling security inputs -->
                </form>

                <!-- Security Access Section -->
                <form onsubmit="return false;">
                    <div id="security-check-container" class="mt-4 border-top pt-3">
                        <label class="form-label small fw-bold text-danger"><i class="bi bi-shield-lock-fill me-1"></i>Seguridad Requerida</label>
                        <div class="input-group input-group-sm mb-2">
                            <input type="password" class="form-control" id="security-pin-input" placeholder="Introducir código para editar" autocomplete="off" data-bs-toggle="tooltip" title="Introduce el código de supervisor">
                            <button class="btn btn-outline-danger" type="button" id="btn-unlock-details" data-bs-toggle="tooltip" title="Desbloquear edición de formulario">
                                <i class="bi bi-unlock-fill me-1"></i>Desbloquear
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btn-save-room-details" disabled onclick="window.saveRoomDetails()" data-bs-toggle="tooltip" title="Guardar cambios permanentemente">
                    <i class="bi bi-save me-1"></i>Guardar Cambios
                </button>
            </div>
        </div>
    </div>
</div>
            </div>
            <div class="tab-pane fade" id="configuracion-content" role="tabpanel">
<div class="d-none d-print-block report-header-print">
    <div class="report-info-left">
        <h2>Configuración del Sistema</h2>
        <p>Hotel Garoé • Recepción Suite</p>
    </div>
    <div class="report-info-right">
        <div><strong>Fecha:</strong> <span id="print-date-config"></span></div>
        <div><strong>Generado por:</strong> <span id="print-repc-nombre-config"></span></div>
    </div>
</div>

<!-- Encabezado del Módulo (Título Dinámico) -->
<h4 class="module-title-discrete">
    <i class="bi bi-gear-fill"></i> CONFIGURACIÓN
</h4>

<!-- Barra de Herramientas -->
<div class="module-toolbar no-print">
    <div class="btn-group" role="group">
        <button class="btn btn-outline-primary active" id="btnConfigMain"
            data-bs-toggle="tooltip" data-bs-title="Editar Configuración">
            <i class="bi bi-sliders me-2"></i>General
        </button>
        <button class="btn btn-outline-danger" onclick="resetConfigToDefault()"
            data-bs-toggle="tooltip" data-bs-title="Restaurar valores de fábrica">
            <i class="bi bi-arrow-counterclockwise me-2"></i>Reset
        </button>
    </div>

    <div class="btn-print-wrapper gap-2">
        <button class="btn btn-success btn-sm fw-bold shadow-sm" onclick="exportConfig()"
            data-bs-toggle="tooltip" data-bs-title="Descargar archivo JSON para guardar cambios permanentemente">
            <i class="bi bi-download me-2"></i>Descargar config.json
        </button>
        <button class="btn btn-primary btn-sm fw-bold shadow-sm" onclick="saveConfigLocal()"
            data-bs-toggle="tooltip" data-bs-title="Aplicar cambios en este navegador">
            <i class="bi bi-save-fill me-2"></i>Aplicar Cambios
        </button>
    </div>
</div>

<!-- Contenedor Principal -->
<div id="configuracion-content-wrapper" class="content-panel animate-fade-in">
    <form id="formConfig" onsubmit="event.preventDefault(); saveConfigLocal();">
        
        <!-- 1. Recepcionistas -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3 bg-white">
                <h6 class="mb-0 fw-bold text-primary">
                    <i class="bi bi-people-fill me-2"></i>Equipo de Recepción
                </h6>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-3">Nombres que aparecerán en los selectores de usuario y firmas.</p>
                <div id="config-recepcionistas-list" class="d-flex flex-wrap gap-2 mb-3"></div>
                
                <div class="input-group input-group-sm" style="max-width: 400px;">
                    <input type="text" id="newRecepcionista" class="form-control" placeholder="Nuevo nombre...">
                    <button class="btn btn-outline-primary" type="button" onclick="addRecepcionista()">
                        <i class="bi bi-plus-lg"></i> Añadir
                    </button>
                </div>
            </div>
        </div>

        <!-- 1.1 Transfers & Destinos -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3 bg-white">
                <h6 class="mb-0 fw-bold text-primary">
                    <i class="bi bi-airplane-engines-fill me-2"></i>Transfers & Destinos
                </h6>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-3">Destinos habituales para mostrar en las opciones de "Transfers".</p>
                <div id="list-destinos-transfers" class="d-flex flex-wrap gap-2 mb-3"></div>
                
                <div class="input-group input-group-sm" style="max-width: 400px;">
                    <input type="text" id="newDestinoTransfer" class="form-control" placeholder="Nuevo destino (ej: Aeropuerto)...">
                    <button class="btn btn-outline-primary" type="button" onclick="addDestinoTransfer()">
                        <i class="bi bi-plus-lg"></i> Añadir
                    </button>
                </div>
            </div>
        </div>

        <!-- 1.2 Ejecutables / Apps Externas -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3 bg-white">
                <h6 class="mb-0 fw-bold text-primary">
                    <i class="bi bi-app-indicator me-2"></i>Accesos Rápidos (Apps)
                </h6>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-3">Botones para lanzar aplicaciones externas desde el dashboard. (Requiere servidor Node.js local).</p>
                
                <div id="list-app-launchers" class="row g-2 mb-3"></div>
                
                <div class="row g-2 align-items-end p-3 bg-light rounded border">
                    <div class="col-md-3">
                        <label class="form-label small fw-bold">Nombre Botón</label>
                        <input type="text" id="newLauncherLabel" class="form-control form-control-sm" placeholder="Ej: Word">
                    </div>
                    <div class="col-md-5">
                        <label class="form-label small fw-bold">Ruta Ejecutable (.exe)</label>
                        <div class="input-group input-group-sm">
                            <input type="text" id="newLauncherPath" class="form-control" placeholder="Ej: C:\Windows\System32\notepad.exe">
                            <button class="btn btn-outline-secondary" type="button" onclick="pickLauncherFile()">
                                <i class="bi bi-folder2-open"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label small fw-bold">Icono</label>
                        <div class="input-group input-group-sm shadow-sm border rounded overflow-hidden">
                            <button class="btn btn-light bg-white border-0 px-2" type="button" onclick="IconSelector.open('newLauncherIcon')" style="min-width: 45px;">
                                <span id="preview-newLauncherIcon"><i class="bi bi-palette text-primary"></i></span>
                            </button>
                            <input type="hidden" id="newLauncherIcon" value="">
                            <input type="text" id="newLauncherIcon_display" class="form-control border-0 bg-transparent" placeholder="Icono..." readonly onclick="IconSelector.open('newLauncherIcon')" style="cursor: pointer;">
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary btn-sm w-100 fw-bold" type="button" onclick="addAppLauncher()">
                            <i class="bi bi-plus-lg"></i> Añadir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Hotel & Sistema -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3 bg-white">
                <h6 class="mb-0 fw-bold text-primary">
                    <i class="bi bi-building me-2"></i>Hotel y Sistema
                </h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label small fw-bold">Nombre del Hotel</label>
                        <input type="text" id="conf_hotel_nombre" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small fw-bold">URL Servidor API</label>
                        <input type="text" id="conf_api_url" class="form-control">
                    </div>
                     <div class="col-md-4">
                        <label class="form-label small fw-bold">Precio Safe (€/día)</label>
                        <input type="number" step="0.01" id="conf_safe_precio" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label small fw-bold">Fondo de Caja (€)</label>
                        <input type="number" step="0.01" id="conf_caja_fondo" class="form-control" placeholder="2000.00">
                    </div>
                </div>
                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <label class="form-label small fw-bold">Contraseña Admin (Opcional)</label>
                        <div class="input-group input-group-sm">
                             <input type="password" id="conf_admin_pass" class="form-control" placeholder="Dejar en blanco para desactivar">
                             <button class="btn btn-outline-secondary" type="button" onclick="Utils.togglePassword('conf_admin_pass')">
                                <i class="bi bi-eye"></i>
                             </button>
                        </div>
                        <div class="form-text text-muted" style="font-size: 0.75rem;">Para funciones sensibles como editar configuracion o borrar datos.</div>
                    </div>

                </div>
            </div>
        </div>


        <!-- 3. Configuración de Habitaciones -->
        <div class="card mb-4 shadow-sm border-0">
            <div class="card-header py-3 bg-white">
                <h6 class="mb-0 fw-bold text-primary">
                    <i class="bi bi-door-open-fill me-2"></i>Gestión de Habitaciones
                </h6>
            </div>
            <div class="card-body">
                
                <!-- A. RANGOS -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label small fw-bold mb-0">Rangos de Habitaciones</label>
                        <span class="badge bg-secondary">Total: <span id="total-rooms-count">0</span> habs.</span>
                    </div>
                    
                    <div class="table-responsive border rounded mb-2">
                        <table class="table table-sm table-striped mb-0 text-center align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 20%">Planta</th>
                                    <th style="width: 30%">Desde</th>
                                    <th style="width: 30%">Hasta</th>
                                    <th style="width: 20%"></th>
                                </tr>
                            </thead>
                            <tbody id="config-rangos-table"></tbody>
                        </table>
                    </div>

                    <!-- Input Add Range -->
                    <div class="input-group input-group-sm">
                        <input type="number" id="newRangePlanta" class="form-control" placeholder="Planta">
                        <input type="number" id="newRangeMin" class="form-control" placeholder="Min (ej: 101)">
                        <input type="number" id="newRangeMax" class="form-control" placeholder="Max (ej: 120)">
                        <button class="btn btn-outline-primary" type="button" onclick="addRango()">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                    </div>
                </div>

                <hr class="text-muted opacity-25">

                <!-- B. FILTROS -->
                <div class="row g-3">
                    <!-- Tipos -->
                    <div class="col-md-4">
                        <label class="form-label small fw-bold">Tipos (Suites, Doble...)</label>
                        <div id="list-filtros-tipos" class="d-flex flex-wrap gap-1 mb-2"></div>
                        <div class="input-group input-group-sm shadow-sm border rounded overflow-hidden">
                            <button class="btn btn-light border-0 px-3 bg-white" type="button" onclick="IconSelector.open('newFiltroTipoEmoji')" title="Elegir Icono" style="min-width: 60px;">
                                <span id="preview-newFiltroTipoEmoji"><i class="bi bi-palette text-primary fs-5"></i></span>
                                <input type="hidden" id="newFiltroTipoEmoji" value="">
                            </button>
                            <input type="text" id="newFiltroTipo" class="form-control border-0 py-2 fw-bold" placeholder="Nombre...">
                            <button class="btn btn-primary px-3" type="button" onclick="addFilter('TIPOS')"><i class="bi bi-plus-lg"></i></button>
                        </div>
                    </div>
                    
                    <!-- Vistas -->
                    <div class="col-md-4">
                        <label class="form-label small fw-bold">Vistas (Mar, Calle...)</label>
                        <div id="list-filtros-vistas" class="d-flex flex-wrap gap-1 mb-2"></div>
                        <div class="input-group input-group-sm shadow-sm border rounded overflow-hidden">
                            <button class="btn btn-light border-0 px-3 bg-white" type="button" onclick="IconSelector.open('newFiltroVistaEmoji')" title="Elegir Icono" style="min-width: 60px;">
                                <span id="preview-newFiltroVistaEmoji"><i class="bi bi-palette text-primary fs-5"></i></span>
                                <input type="hidden" id="newFiltroVistaEmoji" value="">
                            </button>
                            <input type="text" id="newFiltroVista" class="form-control border-0 py-2 fw-bold" placeholder="Nombre...">
                            <button class="btn btn-primary px-3" type="button" onclick="addFilter('VISTAS')"><i class="bi bi-plus-lg"></i></button>
                        </div>
                    </div>

                    <!-- Características -->
                    <div class="col-md-4">
                        <label class="form-label small fw-bold">Características (Jacuzzi...)</label>
                        <div id="list-filtros-carac" class="d-flex flex-wrap gap-1 mb-2"></div>
                        <div class="input-group input-group-sm shadow-sm border rounded overflow-hidden">
                            <button class="btn btn-light border-0 px-3 bg-white" type="button" onclick="IconSelector.open('newFiltroCaracEmoji')" title="Elegir Icono" style="min-width: 60px;">
                                <span id="preview-newFiltroCaracEmoji"><i class="bi bi-palette text-primary fs-5"></i></span>
                                <input type="hidden" id="newFiltroCaracEmoji" value="">
                            </button>
                            <input type="text" id="newFiltroCarac" class="form-control border-0 py-2 fw-bold" placeholder="Nombre...">
                            <button class="btn btn-primary px-3" type="button" onclick="addFilter('CARACTERISTICAS')"><i class="bi bi-plus-lg"></i></button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
    </form>
</div>
        </div>

    </div> <!-- END #app-layout -->



    <!-- Viewer Modal -->
    <div class="modal fade" id="galleryModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content bg-dark text-white border-0">
                <!-- Header de Controles con Z-Index Corregido -->
                <div class="modal-header border-0 bg-transparent position-absolute top-0 start-0 w-100 p-3" style="z-index: 1100; pointer-events: none;">
                    <h5 class="modal-title shadow-sm ps-3 px-2 py-1 rounded bg-dark bg-opacity-25" id="galleryViewerTitle" style="pointer-events: auto;"></h5>
                    <div class="ms-auto pe-3 d-flex align-items-center gap-2" style="pointer-events: auto;">
                        <div id="galleryViewerControls" class="d-flex align-items-center gap-2">
                             <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm fw-bold px-3 rounded-pill" onclick="Gallery.copyCurrent()" title="Copiar al portapapeles">
                                <i class="bi bi-clipboard-plus me-1"></i>Copiar
                            </button>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm fw-bold px-3 rounded-pill" onclick="Gallery.printCurrent()" title="Imprimir">
                                <i class="bi bi-printer me-1"></i>Imprimir
                            </button>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm fw-bold px-3 rounded-pill" onclick="Gallery.toggleFullscreen()" title="Pantalla Completa">
                                <i class="bi bi-arrows-fullscreen me-1"></i>Pantalla Completa
                            </button>
                            <span class="mx-1 text-white-25">|</span>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm rounded-circle" id="galleryRotateLeft" title="Rotar Izquierda"><i class="bi bi-arrow-counterclockwise"></i></button>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm rounded-circle" id="galleryRotateRight" title="Rotar Derecha"><i class="bi bi-arrow-clockwise"></i></button>
                            <span class="mx-1 text-white-25">|</span>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm rounded-circle" id="galleryZoomOut" title="Zoom -"><i class="bi bi-dash-lg"></i></button>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm rounded-circle" id="galleryResetView" title="Restablecer"><i class="bi bi-fullscreen-exit"></i></button>
                            <button type="button" class="btn btn-outline-light border-0 bg-dark bg-opacity-50 btn-sm rounded-circle" id="galleryZoomIn" title="Zoom +"><i class="bi bi-plus-lg"></i></button>
                        </div>
                        <span class="mx-1 text-white-25">|</span>
                        <button type="button" class="btn-close btn-close-white ms-2 shadow-sm" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>

                <div class="modal-body p-0 d-flex justify-content-center align-items-center overflow-hidden position-relative" id="galleryViewerContainer" style="cursor: grab;">
                    <!-- Botones de Navegación Lateral -->
                    <button class="btn btn-dark bg-opacity-25 position-absolute start-0 top-50 translate-middle-y ms-4 rounded-circle p-3 shadow-lg viewer-nav-btn" id="galleryPrevBtn" style="z-index: 1100;" title="Anterior (Flecha Izquierda)">
                        <i class="bi bi-chevron-left fs-2"></i>
                    </button>
                    
                    <img src="" id="galleryViewerImage" style="max-width: 100%; max-height: 100vh; transition: transform 0.1s ease-out; transform-origin: center;">
                    
                    <iframe src="" id="galleryViewerPdf" class="d-none w-100 h-100 border-0" style="min-height: 90vh;"></iframe>

                    <button class="btn btn-dark bg-opacity-25 position-absolute end-0 top-50 translate-middle-y me-4 rounded-circle p-3 shadow-lg viewer-nav-btn" id="galleryNextBtn" style="z-index: 1100;" title="Siguiente (Flecha Derecha)">
                        <i class="bi bi-chevron-right fs-2"></i>
                    </button>
                </div>
                 <div class="position-absolute bottom-0 start-0 w-100 text-center p-3 text-white-50 small bg-gradient-dark pointer-events-none">
                    Rueda Raton: Zoom | Arrastrar: Mover
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="launchPadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-dark text-white border-0 py-2">
                    <h6 class="modal-title fw-bold"><i class="bi bi-grid-3x3-gap-fill me-2"></i>Aplicaciones y Herramientas</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4 bg-light">
                    <!-- Buscador y Filtros -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="input-group shadow-sm">
                                <span class="input-group-text bg-white border-end-0 text-muted px-3"><i class="bi bi-search"></i></span>
                                <input type="text" id="launchPadSearch" class="form-control border-start-0 py-2" placeholder="Buscar por nombre..." onkeyup="window.renderLaunchPad(this.value, window._currentLaunchPadFilter)">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="btn-group w-100 shadow-sm" role="group">
                                <button type="button" class="btn btn-white border px-3 active" id="btnFilterLaunchAll" onclick="window.filterLaunchPad('all')">Todos los Accesos</button>
                                <button type="button" class="btn btn-white border px-3" id="btnFilterLaunchApps" onclick="window.filterLaunchPad('app')">Aplicaciones</button>
                                <button type="button" class="btn btn-white border px-3" id="btnFilterLaunchFolders" onclick="window.filterLaunchPad('folder')">Carpetas Locales</button>
                                <button type="button" class="btn btn-white border px-3" id="btnFilterLaunchVideos" onclick="window.filterLaunchPad('video')">Videos</button>
                                <button type="button" class="btn btn-white border px-3" id="btnFilterLaunchUrls" onclick="window.filterLaunchPad('url')">Recursos Web</button>
                            </div>
                        </div>
                    </div>

                    <div id="launchPadGrid" class="row g-3 justify-content-center">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CORE VENDOR SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
        if (window['pdfjs-dist/build/pdf']) {
            window['pdfjs-dist/build/pdf'].GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        }
    </script>
    <script src="assets/vendor/bootstrap.bundle.min.js?v=2"></script>
    <script src="assets/vendor/chart.min.js?v=2"></script>
    <script src="assets/vendor/html2pdf.bundle.min.js?v=2"></script>
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            // Ignorar errores no cr\u00EDticos de ResizeObserver
            if (msg.includes('ResizeObserver loop')) return false;

            console.error('SYSTEM ERROR:', msg, url, lineNo);
            const errorBox = document.getElementById('global-error-box');
            if (errorBox) {
                errorBox.classList.remove('d-none');
                const list = document.getElementById('error-list-content');
                if (list) list.innerHTML += `<div><strong>${msg}</strong><br><small>${url}:${lineNo}</small></div><hr class="my-1">`;
            }
            return false;
        };
        window.addEventListener('unhandledrejection', event => {
            console.error('UNHANDLED PROMISE:', event.reason);
        });
        
        // Stub inicial para evitar ReferenceError si los m\u00F3dulos fallan o tardan
        window.navegarA = function(target) {
            console.warn('Sistema no cargado a\u00FAn. Intentando navegar a:', target);
            // Opcional: Mostrar toast de "Cargando sistema..."
        };
    </script>
    <!-- YouTube Player Modal -->
    <div class="modal fade" id="youtubePlayerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content bg-black border-0 shadow-lg">
                <div class="modal-header border-0 pb-0">
                    <h6 class="modal-title text-white fw-bold" id="youtubePlayerTitle">Reproductor de Video</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" onclick="window.stopYouTubeVideo()"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="ratio ratio-16x9">
                        <iframe id="youtubeIframe" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Web Viewer Modal -->
    <div class="modal fade" id="webViewerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content border-0">
                <div class="modal-header bg-dark text-white py-2">
                    <h6 class="modal-title fw-bold" id="webViewerTitle">Visor Web</h6>
                    <div class="ms-auto d-flex align-items-center gap-2">
                        <button type="button" class="btn btn-outline-light btn-sm border-0" onclick="window.openExternalWeb()" title="Abrir en nueva ventana">
                            <i class="bi bi-box-arrow-up-right me-1"></i> Abrir fuera
                        </button>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" onclick="window.stopWebViewer()"></button>
                    </div>
                </div>
                <div class="modal-body p-0 overflow-hidden">
                    <iframe id="webViewerIframe" src="" class="w-100 h-100 border-0"></iframe>
                </div>
            </div>
        </div>
    </div>



    <script type="module" src="assets/js/main.js?v=V140_ISOLATED_WINDOW"></script>

    <!-- Spotify Footer Player (Minimizable) -->
    <div id="spotify-footer-player" class="spotify-footer-player no-print minimized">
        <div class="spotify-player-body">
            <iframe id="spotify-footer-iframe" src="" width="100%" height="152" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy" style="border-radius:12px"></iframe>
        </div>
        <button class="spotify-footer-toggle" onclick="toggleSpotifyFooter()">
            <i class="bi bi-spotify me-2"></i> <span id="spotify-toggle-text">Spotify</span>
            <i class="bi bi-chevron-up ms-auto" id="spotify-toggle-icon"></i>
        </button>
    </div>

</body>

</html>